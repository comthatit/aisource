<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡¬í”„íŠ¸ ì±Œë¦°ì§€</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .bounce { animation: bounce 0.5s ease; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* ì±„íŒ… ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .chat-container { background: #f3f4f6; border-radius: 1.5rem; overflow: hidden; border: 1px solid #e5e7eb; }
        .chat-bubble-ai { background: white; border-radius: 0 1rem 1rem 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .chat-bubble-user { background: #6366f1; color: white; border-radius: 1rem 1rem 0 1rem; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const MAX_SCORE = 100;

        // ì±„íŒ… ë©”ì‹œì§€ ì»´í¬ë„ŒíŠ¸
        function ChatMessage({ role, text, icon }) {
            return (
                <div className={`flex ${role === 'user' ? 'justify-end' : 'justify-start'} mb-4 fade-in`}>
                    {role === 'ai' && <div className="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center mr-2 flex-shrink-0 text-sm">ğŸ¤–</div>}
                    <div className={`max-w-[80%] p-4 ${role === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}`}>
                        <p className="text-sm whitespace-pre-line leading-relaxed">{text}</p>
                    </div>
                    {role === 'user' && <div className="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center ml-2 flex-shrink-0 text-sm text-white">ğŸ‘¤</div>}
                </div>
            );
        }

        function PromptChallenge() {
            const [stage, setStage] = useState(0);
            const [totalScore, setTotalScore] = useState(0);
            const [completedStages, setCompletedStages] = useState({
                stage1: false, stage2: false, stage3: false, stage4: false
            });
            const [allStagesCompleted, setAllStagesCompleted] = useState(false);
            
            const updateScore = (points) => {
                setTotalScore(prev => prev + points);
            };
            
            const goToStage = (stageNum) => setStage(stageNum);

            const markStageComplete = (stageKey) => {
                setCompletedStages(prev => ({ ...prev, [stageKey]: true }));
            };

            const stages = [
                { component: IntroStage },
                { component: Stage1 },
                { component: Stage2 },
                { component: Stage3 },
                { component: Stage4 },
                { component: Stage5 }
            ];
            const CurrentComponent = stages[stage].component;

            return (
                <div className="min-h-screen py-8 px-4">
                    <div className="max-w-5xl mx-auto">
                        <div className="text-center mb-6 fade-in">
                            <h1 className="text-4xl md:text-5xl font-bold text-white mb-4">ğŸ¯ í”„ë¡¬í”„íŠ¸ ì±Œë¦°ì§€</h1>
                            <p className="text-xl text-white opacity-90">ë” ì¢‹ì€ ë¬¸ì¥ ë§Œë“¤ê¸°</p>
                        </div>
                        {stage > 0 && (
                            <div className="mb-6 no-print">
                                <div className="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm mb-4">
                                    <div className="flex justify-between items-center">
                                        <div className="text-white font-bold text-lg">
                                            ğŸ† ì ìˆ˜: <span className="text-yellow-300 text-2xl">{totalScore}</span> / {MAX_SCORE}ì 
                                        </div>
                                        <div className="text-white font-bold text-lg">ğŸ“ {stage}/5 ë‹¨ê³„</div>
                                    </div>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm">
                                    <div className="flex justify-around items-center">
                                        {['ê¸°ë³¸ ê²°ê³¼', 'ë¬¸ì œ ë°œê²¬', 'ìˆ˜ì •í•˜ê¸°', 'í”„ë¡¬í”„íŠ¸ ì¶”ë¡ ', 'ê²°ê³¼ í™•ì¸'].map((title, idx) => {
                                            const stageNum = idx + 1;
                                            const isCurrentStage = stageNum === stage;
                                            const isCompleted = completedStages[`stage${stageNum}`] || (stageNum === 5 && allStagesCompleted);
                                            const canAccess = stageNum <= stage || allStagesCompleted;
                                            
                                            return (
                                                <button key={idx} onClick={() => goToStage(stageNum)}
                                                    disabled={!canAccess}
                                                    className={`flex flex-col items-center px-2 py-2 rounded-xl transition-all duration-300 ${
                                                        isCurrentStage ? 'bg-purple-500 text-white scale-110'
                                                        : isCompleted ? 'bg-lime-400 text-white hover:scale-105'
                                                        : 'bg-white bg-opacity-30 text-white opacity-50 cursor-not-allowed'
                                                    }`}>
                                                    <div className="text-lg mb-1">
                                                        {isCompleted ? 'âœ“' : isCurrentStage ? 'â–¶' : stageNum}
                                                    </div>
                                                    <div className="text-xs font-bold">{title}</div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}
                        <CurrentComponent
                            goToStage={goToStage} 
                            updateScore={updateScore} 
                            totalScore={totalScore}
                            markStageComplete={markStageComplete}
                            setAllStagesCompleted={setAllStagesCompleted}
                        />
                    </div>
                </div>
            );
        }

        function IntroStage({ goToStage }) {
            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">ğŸš€</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">í”„ë¡¬í”„íŠ¸ ì±Œë¦°ì§€ì— ë„ì „í•˜ì„¸ìš”!</h2>
                        <p className="text-lg text-gray-600 leading-relaxed mb-6">
                            í”„ë¡¬í”„íŠ¸ë¥¼ ê°œì„ í•˜ëŠ” ì‹¤ìŠµì„ í†µí•´<br/>AIë¥¼ ë” íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ë°°ì›Œë´…ì‹œë‹¤!
                        </p>
                    </div>

                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 mb-8 border-2 border-purple-200">
                        <h3 className="text-xl font-bold text-purple-800 mb-4">ğŸ¯ í•™ìŠµ ëª©í‘œ</h3>
                        <div className="space-y-3 text-left">
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">ğŸ”</span>
                                <p className="text-gray-700 flex-1"><span className="font-bold">í”„ë¡¬í”„íŠ¸ì˜ ë¬¸ì œì </span>ì„ ìŠ¤ìŠ¤ë¡œ ë°œê²¬í•  ìˆ˜ ìˆë‹¤</p>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">âœï¸</span>
                                <p className="text-gray-700 flex-1"><span className="font-bold">í”„ë¡¬í”„íŠ¸ë¥¼ ê°œì„ </span>í•˜ì—¬ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤</p>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">âš¡</span>
                                <p className="text-gray-700 flex-1"><span className="font-bold">í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</span>ì˜ ì‹¤ì „ ê¸°ìˆ ì„ ìµí ìˆ˜ ìˆë‹¤</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-6 mb-8 border-2 border-blue-200">
                        <h3 className="text-xl font-bold text-blue-800 mb-4">ğŸ—ºï¸ ì±Œë¦°ì§€ ê³¼ì •</h3>
                        <div className="grid md:grid-cols-5 gap-3">
                            {[
                                { icon: 'ğŸ“', title: '1ë‹¨ê³„', desc: 'ê¸°ë³¸ ê²°ê³¼' },
                                { icon: 'ğŸ”', title: '2ë‹¨ê³„', desc: 'ë¬¸ì œ ë°œê²¬' },
                                { icon: 'âœï¸', title: '3ë‹¨ê³„', desc: 'ìˆ˜ì •í•˜ê¸°' },
                                { icon: 'ğŸ¯', title: '4ë‹¨ê³„', desc: 'ì¶”ë¡ í•˜ê¸°' },
                                { icon: 'ğŸ“', title: '5ë‹¨ê³„', desc: 'ê²°ê³¼ í™•ì¸' }
                            ].map((step, idx) => (
                                <div key={idx} className="bg-white rounded-xl p-3 text-center">
                                    <div className="text-2xl mb-1">{step.icon}</div>
                                    <div className="font-bold text-gray-800 text-xs mb-1">{step.title}</div>
                                    <div className="text-xs text-gray-600">{step.desc}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <button onClick={() => goToStage(1)}
                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xl font-bold py-5 px-8 rounded-2xl hover:shadow-2xl transform hover:scale-105 transition-all">
                        ğŸ¯ ì±Œë¦°ì§€ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            );
        }

        /* 1ë‹¨ê³„: ì±„íŒ… UIë¡œ ë³€ê²½ */
        function Stage1({ goToStage, markStageComplete }) {
            const [currentChallenge, setCurrentChallenge] = useState(0);
            const [chatHistory, setChatHistory] = useState([]);
            const [showAnalysis, setShowAnalysis] = useState(false);

            const challenges = [
                {
                    id: 'c1',
                    topic: 'ì´ë¯¸ì§€ ìƒì„± ìš”ì²­',
                    basicPrompt: 'ê·€ì—¬ìš´ ê°•ì•„ì§€ê°€ í’€ë°­ì—ì„œ ë…¸ëŠ” ê·¸ë¦¼ ê·¸ë ¤ì¤˜',
                    basicResult: 'ê°•ì•„ì§€ í•œ ë§ˆë¦¬ê°€ í’€ë°­ì— ì„œ ìˆëŠ” ê·¸ë¦¼',
                    feedback: {
                        problem: 'ê¸°ë³¸ ì •ë³´ëŠ” ìˆì§€ë§Œ ì—¬ì „íˆ ë§ì´ ë¶€ì¡±í•´ìš”.',
                        issues: ['ê°•ì•„ì§€ì˜ í’ˆì¢…ì´ ëª…ì‹œë˜ì§€ ì•ŠìŒ', 'ì–´ë–¤ í–‰ë™ì¸ì§€ ë¶ˆëª…í™• ("ë…¸ëŠ”"ì´ ì• ë§¤í•¨)', 'ì‹œê°„ëŒ€ë‚˜ ë‚ ì”¨ ê°™ì€ ë¶„ìœ„ê¸° ì—†ìŒ', 'ê·¸ë¦¼ ìŠ¤íƒ€ì¼ì´ ì§€ì •ë˜ì§€ ì•ŠìŒ'],
                        improvement: {
                            example: '"ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„ê°€ í–‡ì‚´ ê°€ë“í•œ ê³µì› ì”ë””ë°­ì—ì„œ ë¹¨ê°„ ê³µì„ ë¬¼ê³  ë›°ì–´ê°€ëŠ” ëª¨ìŠµì„ ë”°ëœ»í•œ ëŠë‚Œì˜ ìˆ˜ì±„í™” ìŠ¤íƒ€ì¼ë¡œ ê·¸ë ¤ì¤˜"',
                            why: 'í’ˆì¢…(ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„), ì¥ì†Œ(í–‡ì‚´ ê°€ë“í•œ ê³µì› ì”ë””ë°­), êµ¬ì²´ì  í–‰ë™(ë¹¨ê°„ ê³µì„ ë¬¼ê³  ë›°ì–´ê°), ìŠ¤íƒ€ì¼(ë”°ëœ»í•œ ìˆ˜ì±„í™”)ì„ ëª¨ë‘ ëª…ì‹œí•˜ë©´ ì •í™•íˆ ì›í•˜ëŠ” ê·¸ë¦¼ì„ ì–»ì„ ìˆ˜ ìˆì–´ìš”!'
                        },
                        nextStep: 'ì´ë¯¸ì§€ ìƒì„±ì—ëŠ” "ë¬´ì—‡ì„", "ì–´ë””ì„œ", "ì–´ë–»ê²Œ", "ì–´ë–¤ ìŠ¤íƒ€ì¼ë¡œ"ê°€ ëª¨ë‘ í•„ìš”í•´ìš”. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì´ëŸ° ìš”ì†Œë“¤ì´ ì™œ ì¤‘ìš”í•œì§€ ë°°ì›Œë´…ì‹œë‹¤!'
                    }
                },
                {
                    id: 'c2',
                    topic: 'ë²ˆì—­ ìš”ì²­',
                    basicPrompt: 'ì´ ë¬¸ì¥ì„ ì˜ì–´ë¡œ ë²ˆì—­í•´ì¤˜: ì•ˆë…•í•˜ì„¸ìš”',
                    basicResult: 'Hello',
                    feedback: {
                        problem: 'ë²ˆì—­í•  í…ìŠ¤íŠ¸ëŠ” ìˆì§€ë§Œ ë§¥ë½ì´ ì—†ì–´ìš”.',
                        issues: ['ì–´ë–¤ ìƒí™©ì—ì„œ ì“°ëŠ”ì§€ ë¶ˆëª…í™•', 'ê²©ì‹ ìˆ˜ì¤€ì´ ëª…ì‹œë˜ì§€ ì•ŠìŒ', 'ë²ˆì—­ì˜ ëª©ì ì´ ì—†ìŒ'],
                        improvement: {
                            example: '"\'ì•ˆë…•í•˜ì„¸ìš”, ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤\'ë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¸íŒ… ìƒí™©ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì •ì¤‘í•˜ê³  ê²©ì‹ìˆëŠ” ì˜ì–´ë¡œ ë²ˆì—­í•´ì¤˜"',
                            why: 'ì‚¬ìš© ìƒí™©(ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¸íŒ…), í†¤(ì •ì¤‘í•˜ê³  ê²©ì‹ìˆëŠ”)ì„ ëª…ì‹œí•˜ë©´ ìƒí™©ì— ë”± ë§ëŠ” ë²ˆì—­ì„ ì–»ì„ ìˆ˜ ìˆì–´ìš”!'
                        },
                        nextStep: 'ê°™ì€ "ì•ˆë…•í•˜ì„¸ìš”"ë„ ì¹œêµ¬ì—ê²Œ, ê³ ê°ì—ê²Œ, êµìˆ˜ë‹˜ê»˜ ì“¸ ë•Œ ëª¨ë‘ ë‹¬ë¼ìš”. ë²ˆì—­ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë§¥ë½ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë” ì•Œì•„ë´…ì‹œë‹¤!'
                    }
                },
                {
                    id: 'c3',
                    topic: 'ì´ë©”ì¼ ì‘ì„±',
                    basicPrompt: 'ê³ ê°ì—ê²Œ ë³´ë‚¼ ê°ì‚¬ ì´ë©”ì¼ ì¨ì¤˜',
                    basicResult: 'ê³ ê°ë‹˜ê»˜\n\nê°ì‚¬í•©ë‹ˆë‹¤.\n\në‹´ë‹¹ì ë“œë¦¼',
                    feedback: {
                        problem: 'ëŒ€ìƒê³¼ ëª©ì ì€ ìˆì§€ë§Œ êµ¬ì²´ì  ë‚´ìš©ì´ ì—†ì–´ìš”.',
                        issues: ['ë¬´ì—‡ì— ëŒ€í•œ ê°ì‚¬ì¸ì§€ ë¶ˆëª…í™•', 'ì–´ë–¤ ìƒí™©ì¸ì§€ ëª¨ë¦„', 'ì´ë©”ì¼ ê¸¸ì´ë‚˜ êµ¬ì¡° ë¯¸ëª…ì‹œ', 'í›„ì† í–‰ë™ì´ ìˆëŠ”ì§€ ë¶ˆëª…í™•'],
                        improvement: {
                            example: '"ì‹ ì œí’ˆ êµ¬ë§¤í•´ì£¼ì‹  ê³ ê°ì—ê²Œ ë³´ë‚¼ ê°ì‚¬ ì´ë©”ì¼ì„ ì •ì¤‘í•˜ê²Œ ì‘ì„±í•´ì¤˜. êµ¬ë§¤ ê°ì‚¬ ì¸ì‚¬ì™€ í•¨ê»˜ ë‹¤ìŒ êµ¬ë§¤ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ 10% í• ì¸ ì¿ í°ì„ ì•ˆë‚´í•˜ëŠ” ë‚´ìš©ì„ í¬í•¨í•´ì¤˜"',
                            why: 'êµ¬ì²´ì  ìƒí™©(ì‹ ì œí’ˆ êµ¬ë§¤), í†¤(ì •ì¤‘í•˜ê²Œ), í•µì‹¬ ë‚´ìš©(ê°ì‚¬+í• ì¸ ì¿ í° ì•ˆë‚´)ì„ ëª…ì‹œí•˜ë©´ ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì„ ì–»ì–´ìš”!'
                        },
                        nextStep: 'AIëŠ” ë§ˆìŒì„ ì½ì„ ìˆ˜ ì—†ì–´ìš”! "ê°ì‚¬ ì´ë©”ì¼"ì´ë¼ê³ ë§Œ í•˜ë©´ ë¬´ì—‡ì— ê°ì‚¬í•˜ëŠ”ì§€, ì–´ë–¤ ë‚´ìš©ì„ ë‹´ì„ì§€ ì•Œ ìˆ˜ ì—†ì£ . ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ëª…í™•í•œ ì§€ì‹œì˜ í˜ì„ ê²½í—˜í•´ë´…ì‹œë‹¤!'
                    }
                }
            ];

            const currentC = challenges[currentChallenge];

            useEffect(() => {
                setChatHistory([{ role: 'ai', text: `ì•ˆë…•í•˜ì„¸ìš”! "${currentC.topic}"ì— ëŒ€í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.` }]);
                setShowAnalysis(false);
            }, [currentChallenge]);

            const handleSendPrompt = () => {
                const newHistory = [
                    ...chatHistory,
                    { role: 'user', text: currentC.basicPrompt }
                ];
                setChatHistory(newHistory);
                
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.basicResult }]);
                    setShowAnalysis(true);
                }, 800);
            };

            const handleNext = () => {
                if (currentChallenge < challenges.length - 1) {
                    setCurrentChallenge(currentChallenge + 1);
                } else {
                    markStageComplete('stage1');
                    goToStage(2);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">ğŸ“</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">1ë‹¨ê³„: ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ê²°ê³¼ í™•ì¸</h2>
                        <p className="text-gray-600 mb-2">ì±Œë¦°ì§€ {currentChallenge + 1} / {challenges.length}</p>
                    </div>

                    <div className="chat-container mb-8 p-6 flex flex-col min-h-[400px]">
                        <div className="flex-1 overflow-y-auto mb-4">
                            {chatHistory.map((chat, idx) => (
                                <ChatMessage key={idx} role={chat.role} text={chat.text} />
                            ))}
                        </div>
                        
                        {!showAnalysis && (
                            <div className="flex gap-2 bg-white p-2 rounded-2xl border-2 border-purple-200">
                                <div className="flex-1 p-3 text-gray-400 text-sm">"{currentC.basicPrompt}" ë¼ê³  ì…ë ¥í•˜ê¸°</div>
                                <button onClick={handleSendPrompt} className="bg-purple-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-purple-700 transition-colors">ì „ì†¡</button>
                            </div>
                        )}
                    </div>

                    {showAnalysis && (
                        <div className="space-y-6 fade-in">
                            <div className="bg-red-50 rounded-xl p-6 border-2 border-red-300">
                                <h4 className="font-bold text-red-800 text-lg mb-3">âš ï¸ {currentC.feedback.problem}</h4>
                                <div className="grid md:grid-cols-2 gap-2">
                                    {currentC.feedback.issues.map((issue, idx) => (
                                        <div key={idx} className="flex items-center bg-white rounded-lg p-3">
                                            <span className="text-red-500 mr-2">âœ—</span>
                                            <span className="text-sm text-gray-700">{issue}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-green-50 rounded-xl p-6 border-2 border-green-300">
                                <h4 className="font-bold text-green-800 text-lg mb-3">ğŸ’¡ ê°œì„  ë°©ë²•</h4>
                                <div className="bg-white rounded-lg p-4 mb-4 border-l-4 border-green-500">
                                    <p className="text-xs text-gray-600 mb-1">âœ… ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ:</p>
                                    <p className="text-gray-800 font-medium">{currentC.feedback.improvement.example}</p>
                                </div>
                                <p className="text-sm text-gray-700">{currentC.feedback.improvement.why}</p>
                            </div>

                            <button onClick={handleNext} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xl font-bold py-5 rounded-2xl">
                                {currentChallenge < challenges.length - 1 ? 'ë‹¤ìŒ ì±Œë¦°ì§€ âœ' : '2ë‹¨ê³„ë¡œ ì´ë™ âœ'}
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        /* 2ë‹¨ê³„: ì±„íŒ… í›„ ë¬¸ì œë°œê²¬ UI */
        function Stage2({ goToStage, updateScore, markStageComplete }) {
            const [currentChallenge, setCurrentChallenge] = useState(0);
            const [isChatted, setIsChatted] = useState(false);
            const [chatHistory, setChatHistory] = useState([]);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [earnedScore, setEarnedScore] = useState(0);

            const challenges = [
                {
                    id: 'c1',
                    topic: 'ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…',
                    basicPrompt: 'ë¸”ë¡œê·¸ ê¸€ ì¨ì¤˜',
                    aiResult: 'ì œëª©\në‚´ìš©\në§ˆë¬´ë¦¬',
                    question: 'ì´ í”„ë¡¬í”„íŠ¸ì—ì„œ ë¶€ì¡±í•œ ë¶€ë¶„ì€?',
                    options: [
                        { id: 'a', text: 'ì œëª©ì„ ë¯¸ë¦¬ ì •í•˜ì§€ ì•Šì•˜ë‹¤', correct: false },
                        { id: 'b', text: 'ì–´ë–¤ ì£¼ì œì— ëŒ€í•´ ì“¸ì§€, ëˆ„êµ¬ë¥¼ ìœ„í•œ ê¸€ì¸ì§€ ëª…ì‹œí•˜ì§€ ì•Šì•˜ë‹¤', correct: true },
                        { id: 'c', text: 'ê¸€ì ìˆ˜ë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ë‹¤', correct: false },
                        { id: 'd', text: 'ì‚¬ìš©í•  ì´ë¯¸ì§€ë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ë‹¤', correct: false }
                    ],
                    explanation: 'ì •ë‹µ! AIëŠ” ë¬´ì—‡ì— ëŒ€í•´(ì£¼ì œ), ëˆ„êµ¬ë¥¼ ìœ„í•´(íƒ€ê²Ÿ ë…ì), ì–´ë–¤ ëŠë‚Œìœ¼ë¡œ(í†¤) ì“¸ì§€ë¥¼ ì•Œì•„ì•¼ ì˜ë¯¸ìˆëŠ” ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆì–´ìš”.',
                    points: 15
                },
                {
                    id: 'c2',
                    topic: 'íšŒì˜ë¡ ì‘ì„±',
                    basicPrompt: 'íšŒì˜ë¡ ë§Œë“¤ì–´ì¤˜',
                    aiResult: 'íšŒì˜ ì¼ì‹œ:\nì°¸ì„ì:\në‚´ìš©:',
                    question: 'ì´ í”„ë¡¬í”„íŠ¸ì˜ ê°€ì¥ í° ë¬¸ì œì ì€?',
                    options: [
                        { id: 'a', text: 'íšŒì˜ì‹¤ ìœ„ì¹˜ê°€ ëª…ì‹œë˜ì§€ ì•Šì•˜ë‹¤', correct: false },
                        { id: 'b', text: 'íšŒì˜ ì‹œê°„ì´ ëª‡ ì‹œê°„ì¸ì§€ ì•ˆ ì ì—ˆë‹¤', correct: false },
                        { id: 'c', text: 'íšŒì˜ì—ì„œ ë¬´ì—‡ì„ ë…¼ì˜í–ˆëŠ”ì§€, ì–´ë–¤ ê²°ì •ì´ ë‚¬ëŠ”ì§€ ë‚´ìš©ì´ ì—†ë‹¤', correct: true },
                        { id: 'd', text: 'íšŒì˜ ì°¸ì„ì ì´ë¦„ì„ ì•ˆ ì ì—ˆë‹¤', correct: false }
                    ],
                    explanation: 'ì •ë‹µì…ë‹ˆë‹¤! íšŒì˜ì˜ ì‹¤ì œ ë‚´ìš©(ë…¼ì˜ ì‚¬í•­, ê²°ì • ì‚¬í•­)ì´ ì—†ìœ¼ë©´ AIê°€ ë¹ˆ í‹€ë§Œ ë§Œë“¤ ìˆ˜ë°–ì— ì—†ì–´ìš”.',
                    points: 15
                },
                {
                    id: 'c3',
                    topic: 'ìƒí’ˆ ë¦¬ë·°',
                    basicPrompt: 'ì œí’ˆ ë¦¬ë·° ì¨ì¤˜',
                    aiResult: 'ì´ ì œí’ˆì€ ì¢‹ìŠµë‹ˆë‹¤.',
                    question: 'ì´ í”„ë¡¬í”„íŠ¸ì— ê¼­ í•„ìš”í•œ ì •ë³´ëŠ”?',
                    options: [
                        { id: 'a', text: 'ì œí’ˆ ì‚¬ì§„', correct: false },
                        { id: 'b', text: 'ì œí’ˆ ê°€ê²©', correct: false },
                        { id: 'c', text: 'ì–´ë–¤ ì œí’ˆì„ ì¨ë´¤ëŠ”ì§€, ì¥ë‹¨ì ì´ ë¬´ì—‡ì¸ì§€', correct: true },
                        { id: 'd', text: 'ì œí’ˆì„ ì‚° ë‚ ì§œ', correct: false }
                    ],
                    explanation: 'ì •ë‹µì…ë‹ˆë‹¤! ì–´ë–¤ ì œí’ˆì¸ì§€, ì‹¤ì œ ì‚¬ìš© ê²½í—˜ê³¼ ì¥ë‹¨ì ì„ ì•Œë ¤ì¤˜ì•¼ AIê°€ ì‹¤ì§ˆì ì¸ ë¦¬ë·°ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆì–´ìš”.',
                    points: 10
                }
            ];

            const currentC = challenges[currentChallenge];

            useEffect(() => {
                setChatHistory([{ role: 'ai', text: `ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?` }]);
                setIsChatted(false);
                setShowFeedback(false);
                setSelectedAnswer(null);
            }, [currentChallenge]);

            const startChat = () => {
                setChatHistory(prev => [...prev, { role: 'user', text: currentC.basicPrompt }]);
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.aiResult }]);
                    setIsChatted(true);
                }, 800);
            };

            const handleAnswer = (optionId) => {
                if (showFeedback) return;
                setSelectedAnswer(optionId);
                setShowFeedback(true);
                const option = currentC.options.find(o => o.id === optionId);
                if (option.correct) {
                    updateScore(currentC.points);
                    setEarnedScore(prev => prev + currentC.points);
                }
            };

            const handleNext = () => {
                if (currentChallenge < challenges.length - 1) {
                    setCurrentChallenge(currentChallenge + 1);
                } else {
                    markStageComplete('stage2');
                    goToStage(3);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">ğŸ”</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">2ë‹¨ê³„: í”„ë¡¬í”„íŠ¸ì˜ ë¬¸ì œì  ì°¾ê¸°</h2>
                        <div className="mt-2 inline-block bg-purple-100 px-4 py-1 rounded-full text-purple-800 font-bold">íšë“ ì ìˆ˜: {earnedScore}ì </div>
                    </div>

                    <div className="chat-container mb-8 p-6 flex flex-col min-h-[300px]">
                        <div className="flex-1 overflow-y-auto mb-4">
                            {chatHistory.map((chat, idx) => (
                                <ChatMessage key={idx} role={chat.role} text={chat.text} />
                            ))}
                        </div>
                        {!isChatted && (
                            <button onClick={startChat} className="bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all">
                                ğŸ’¬ "{currentC.basicPrompt}" ì…ë ¥í•˜ê³  ê²°ê³¼ ë³´ê¸°
                            </button>
                        )}
                    </div>

                    {isChatted && (
                        <div className="fade-in">
                            <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">ğŸ¤” {currentC.question}</h3>
                            <div className="space-y-3 mb-6">
                                {currentC.options.map((option) => (
                                    <button key={option.id} onClick={() => handleAnswer(option.id)} disabled={showFeedback}
                                        className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                                            showFeedback ? (option.correct ? 'bg-green-100 border-green-500' : (option.id === selectedAnswer ? 'bg-red-100 border-red-500' : 'bg-gray-50 border-gray-200'))
                                            : 'bg-white border-gray-300 hover:border-purple-400'
                                        }`}>
                                        <span className="font-bold mr-3">{option.id.toUpperCase()}.</span> {option.text}
                                    </button>
                                ))}
                            </div>
                            {showFeedback && (
                                <div className={`p-6 rounded-2xl mb-6 border-2 ${currentC.options.find(o => o.id === selectedAnswer)?.correct ? 'bg-green-50 border-green-200' : 'bg-orange-50 border-orange-200'}`}>
                                    <p className="font-bold mb-2">{currentC.options.find(o => o.id === selectedAnswer)?.correct ? 'ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!' : 'ğŸ’¡ ë‹¤ì‹œ í™•ì¸í•´ë³¼ê¹Œìš”?'}</p>
                                    <p className="text-gray-700">{currentC.explanation}</p>
                                    <button onClick={handleNext} className="w-full mt-4 bg-purple-600 text-white py-4 rounded-xl font-bold">
                                        {currentChallenge < challenges.length - 1 ? 'ë‹¤ìŒ ë¬¸ì œ âœ' : '3ë‹¨ê³„ë¡œ ì´ë™ âœ'}
                                    </button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        /* 3ë‹¨ê³„: ì±„íŒ… ìˆ˜ì • UI */
        function Stage3({ goToStage, markStageComplete }) {
            const [currentChallenge, setCurrentChallenge] = useState(0);
            const [chatHistory, setChatHistory] = useState([]);
            const [showImproved, setShowImproved] = useState(false);

            const challenges = [
                {
                    id: 'c1',
                    topic: 'ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜',
                    basicPrompt: 'ì¸ìŠ¤íƒ€ ê¸€ ì¨ì¤˜',
                    improvedPrompt: 'ì¹´í˜ ì°½ì—… 3ì£¼ë…„ì„ ì¶•í•˜í•˜ëŠ” ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜ì„ ì¨ì¤˜. ê°ì‚¬ ì¸ì‚¬ì™€ í•¨ê»˜ ì´ë²ˆ ì£¼ íŠ¹ë³„ ì´ë²¤íŠ¸(ì•„ë©”ë¦¬ì¹´ë…¸ 1+1)ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í™ë³´í•˜ê³ , í•´ì‹œíƒœê·¸ 5ê°œ í¬í•¨í•´ì¤˜. ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ í†¤ìœ¼ë¡œ',
                    improvedResult: 'ìš°ë¦¬ ì¹´í˜ê°€ ë²Œì¨ 3ì£¼ë…„ì„ ë§ì´í–ˆì–´ìš”! ğŸ‰\n\ní•­ìƒ ì°¾ì•„ì£¼ì‹œëŠ” ëª¨ë“  ë¶„ë“¤ ë•ë¶„ì— ì—¬ê¸°ê¹Œì§€ ì˜¬ ìˆ˜ ìˆì—ˆì–´ìš”. ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤ â˜•ï¸ğŸ’•\n\nê°ì‚¬ì˜ ë§ˆìŒì„ ë‹´ì•„ ì´ë²ˆ ì£¼ ë‚´ë‚´ ì•„ë©”ë¦¬ì¹´ë…¸ 1+1 ì´ë²¤íŠ¸ë¥¼ ì§„í–‰í•´ìš”! ì†Œì¤‘í•œ ë¶„ê³¼ í•¨ê»˜ ë§›ìˆëŠ” ì»¤í”¼ í•œ ì” ì–´ë– ì„¸ìš”?\n\nì•ìœ¼ë¡œë„ ë” ì¢‹ì€ ì»¤í”¼ì™€ ë”°ëœ»í•œ ê³µê°„ìœ¼ë¡œ ì°¾ì•„ëµê²Œìš” ğŸŒŸ\n\n#ì¹´í˜3ì£¼ë…„ #ê°ì‚¬ì´ë²¤íŠ¸ #ì•„ë©”ë¦¬ì¹´ë…¸1+1 #ë™ë„¤ì¹´í˜ #ì»¤í”¼ìŠ¤íƒ€ê·¸ë¨',
                    suggestions: ['ëª©ì  ëª…ì‹œ (3ì£¼ë…„ ì¶•í•˜)', 'êµ¬ì²´ì  ì´ë²¤íŠ¸ (ì•„ë©”ë¦¬ì¹´ë…¸ 1+1)', 'í†¤ ì§€ì • (ì¹œê·¼í•˜ê³  ë”°ëœ»í•˜ê²Œ)', 'í˜•ì‹ ìš”ì²­ (í•´ì‹œíƒœê·¸ 5ê°œ)']
                },
                {
                    id: 'c2',
                    topic: 'ê°„í¸ ìš”ë¦¬ ë ˆì‹œí”¼',
                    basicPrompt: 'ìš”ë¦¬ ë ˆì‹œí”¼ ì•Œë ¤ì¤˜',
                    improvedPrompt: 'í˜¼ì ì‚¬ëŠ” ì§ì¥ì¸ì„ ìœ„í•œ 10ë¶„ ì™„ì„± ê¹€ì¹˜ë³¶ìŒë°¥ ë ˆì‹œí”¼ë¥¼ ì•Œë ¤ì¤˜. 1ì¸ë¶„ ê¸°ì¤€ìœ¼ë¡œ ì¬ë£Œì™€ ë¶„ëŸ‰ì„ ëª…ì‹œí•˜ê³ , ìš”ë¦¬ ì´ˆë³´ë„ ë”°ë¼í•  ìˆ˜ ìˆê²Œ ê° ë‹¨ê³„ë§ˆë‹¤ íŒì„ ì¶”ê°€í•´ì¤˜',
                    improvedResult: 'â° 10ë¶„ ì™„ì„±! ì§ì¥ì¸ ê¹€ì¹˜ë³¶ìŒë°¥\n\nğŸ“‹ ì¬ë£Œ (1ì¸ë¶„)\nâ€¢ ë°¥ 1ê³µê¸° (ì°¨ê°€ìš´ ë°¥ì´ ë” ì¢‹ì•„ìš”)\nâ€¢ ê¹€ì¹˜ 100g (ì†¡ì†¡ ì°ê¸°)\nâ€¢ ì‹ìš©ìœ  1í°ìˆ \nâ€¢ ê¹€ì¹˜êµ­ë¬¼ 2í°ìˆ \nâ€¢ ê°„ì¥ 1ì‘ì€ìˆ \nâ€¢ ì°¸ê¸°ë¦„ 1ì‘ì€ìˆ \nâ€¢ ë‹¬ê±€ 1ê°œ (ì„ íƒ)\nâ€¢ ê¹€ê°€ë£¨ ì•½ê°„\n\nğŸ‘¨â€ğŸ³ ì¡°ë¦¬ë²•\n1. ë‹¬êµ° íŒ¬ì— ì‹ìš©ìœ  ë‘ë¥´ê¸°\n   ğŸ’¡ TIP: ì„¼ ë¶ˆë¡œ ì˜ˆì—´í•˜ë©´ ë³¶ìŒë°¥ì´ ëˆŒëŸ¬ë¶™ì§€ ì•Šì•„ìš”\n\n2. ì¬ ê¹€ì¹˜ ë³¶ê¸° (2ë¶„)\n   ğŸ’¡ TIP: ê¹€ì¹˜ê°€ ì‚´ì§ íˆ¬ëª…í•´ì§ˆ ë•Œê¹Œì§€!\n\n3. ë°¥ ë„£ê³  ì£¼ê±±ìœ¼ë¡œ ë¶€ìˆ˜ë©° ë³¶ê¸° (3ë¶„)\n   ğŸ’¡ TIP: ë°¥ì„ ë¨¼ì € ì†ìœ¼ë¡œ ì‚´ì‚´ í’€ì–´ë‘ë©´ ë” ì‰¬ì›Œìš”\n\n4. ê¹€ì¹˜êµ­ë¬¼, ê°„ì¥ ë„£ê³  ì„ê¸° (1ë¶„)\n   ğŸ’¡ TIP: ê¹€ì¹˜ê°€ ì‹±ê±°ìš°ë©´ ê°„ì¥ì„ ì¡°ê¸ˆ ë”!\n\n5. ì°¸ê¸°ë¦„ ë„£ê³  ë§ˆë¬´ë¦¬\n\n6. í”„ë¼ì´íŒ¬ í•œìª½ì— ë‹¬ê±€ í”„ë¼ì´ (ì„ íƒ)\n\n7. ì ‘ì‹œì— ë‹´ê³  ê¹€ê°€ë£¨ ë¿Œë¦¬ê¸°\n\nğŸ‰ ì™„ì„±! ë“ ë“ í•œ í•œ ë¼ ì™„ì„±ì´ì—ìš”',
                    suggestions: ['íƒ€ê²Ÿ ëª…ì‹œ (í˜¼ì ì‚¬ëŠ” ì§ì¥ì¸)', 'ì‹œê°„ ì œí•œ (10ë¶„)', 'ìš”ë¦¬ëª… êµ¬ì²´í™” (ê¹€ì¹˜ë³¶ìŒë°¥)', 'ë°°ë ¤ ìš”ì²­ (ì´ˆë³´ìš© íŒ)']
                },
                {
                    id: 'c3',
                    topic: 'ì–´ë¦°ì´ êµìœ¡ ìë£Œ',
                    basicPrompt: 'êµìœ¡ ìë£Œ ë§Œë“¤ì–´ì¤˜',
                    improvedPrompt: 'ì´ˆë“±í•™êµ 3í•™ë…„ í•™ìƒë“¤ì´ íƒœì–‘ê³„ë¥¼ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆëŠ” í•™ìŠµ ìë£Œë¥¼ ë§Œë“¤ì–´ì¤˜. ê° í–‰ì„±ì˜ íŠ¹ì§•ì„ ì´ëª¨ì§€ì™€ í•¨ê»˜ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ê³ , í¬ê¸° ë¹„êµì™€ ê¸°ì–µí•˜ê¸° ì‰¬ìš´ ìˆœì„œ ì•”ê¸°ë²•ë„ í¬í•¨í•´ì¤˜',
                    improvedResult: 'ğŸŒŸ íƒœì–‘ê³„ ì—¬í–‰ì„ ë– ë‚˜ë³¼ê¹Œìš”?\n\nğŸŒ íƒœì–‘\nìš°ë¦¬ íƒœì–‘ê³„ì˜ ì¤‘ì‹¬! ì—„ì²­ ëœ¨ê±°ìš´ ë¶ˆë©ì–´ë¦¬ì˜ˆìš”.\n\nğŸª 8ê°œ í–‰ì„± ìˆœì„œ ì™¸ìš°ê¸°\n"ìˆ˜ê¸ˆì§€í™”ëª©í† ì²œí•´"\nìˆ˜(ìˆ˜ì„±) ê¸ˆ(ê¸ˆì„±) ì§€(ì§€êµ¬) í™”(í™”ì„±) ëª©(ëª©ì„±) í† (í† ì„±) ì²œ(ì²œì™•ì„±) í•´(í•´ì™•ì„±)\n\nã€í–‰ì„± ì†Œê°œã€‘\n\nâ˜¿ï¸ 1. ìˆ˜ì„±\nâ€¢ íƒœì–‘ì— ê°€ì¥ ê°€ê¹Œì›Œìš”\nâ€¢ ê°€ì¥ ì‘ê³  ë¹¨ë¼ìš”\nâ€¢ ë‚®ì—ëŠ” ì—„ì²­ ë¥ê³  ë°¤ì—ëŠ” ì—„ì²­ ì¶”ì›Œìš”\n\nâ™€ï¸ 2. ê¸ˆì„±\nâ€¢ ì œì¼ ë°ê²Œ ë¹›ë‚˜ìš” (ì €ë…ì˜ ë³„)\nâ€¢ ë‘êº¼ìš´ êµ¬ë¦„ìœ¼ë¡œ ë®ì—¬ìˆì–´ìš”\nâ€¢ ê°€ì¥ ëœ¨ê±°ìš´ í–‰ì„±ì´ì—ìš”\n\nğŸŒ 3. ì§€êµ¬\nâ€¢ ìš°ë¦¬ê°€ ì‚¬ëŠ” í–‰ì„±!\nâ€¢ ë¬¼ì´ ìˆëŠ” ìœ ì¼í•œ í–‰ì„±\nâ€¢ í‘¸ë¥¸ ìƒ‰ì´ ì•„ë¦„ë‹¤ì›Œìš”\n\nğŸ”´ 4. í™”ì„±\nâ€¢ ë¹¨ê°„ í–‰ì„±\nâ€¢ í™ì´ ë¹¨ê°œì„œ í™”ì„±ì´ë˜ìš”\nâ€¢ ë¯¸ë˜ì— ì‚¬ëŒì´ ì‚´ ìˆ˜ë„ ìˆëŒ€ìš”\n\nğŸŸ¤ 5. ëª©ì„±\nâ€¢ ì œì¼ í° í–‰ì„±!\nâ€¢ ì§€êµ¬ë³´ë‹¤ 1,300ë°°ë‚˜ ì»¤ìš”\nâ€¢ ê±°ëŒ€í•œ ë¹¨ê°„ ì ì´ íŠ¹ì§•\n\nğŸ’ 6. í† ì„±\nâ€¢ ì•„ë¦„ë‹¤ìš´ ê³ ë¦¬ê°€ ìˆì–´ìš”\nâ€¢ ì–¼ìŒê³¼ ëŒë¡œ ë§Œë“¤ì–´ì§„ ê³ ë¦¬\nâ€¢ ë‘ ë²ˆì§¸ë¡œ í° í–‰ì„±\n\nğŸ’™ 7. ì²œì™•ì„±\nâ€¢ ì˜†ìœ¼ë¡œ ëˆ„ì›Œì„œ ëŒì•„ìš”\nâ€¢ ì²­ë¡ìƒ‰ì´ì—ìš”\nâ€¢ ì—„ì²­ ì¶”ì›Œìš”\n\nğŸ’™ 8. í•´ì™•ì„±\nâ€¢ íƒœì–‘ì—ì„œ ê°€ì¥ ë©€ì–´ìš”\nâ€¢ ì§™ì€ íŒŒë€ìƒ‰\nâ€¢ ê°€ì¥ ì„¼ ë°”ëŒì´ ë¶ˆì–´ìš”\n\nğŸ“ í¬ê¸° ë¹„êµ\nëª©ì„± > í† ì„± > ì²œì™•ì„± > í•´ì™•ì„± > ì§€êµ¬ > ê¸ˆì„± > í™”ì„± > ìˆ˜ì„±\n\nâœ¨ ëª©ì„±ì€ ì§€êµ¬ë¥¼ 1,300ê°œë‚˜ ë„£ì„ ìˆ˜ ìˆì„ ë§Œí¼ ê±°ëŒ€í•´ìš”!',
                    suggestions: ['ëŒ€ìƒ ì—°ë ¹ (ì´ˆ3)', 'ì£¼ì œ ëª…ì‹œ (íƒœì–‘ê³„)', 'í˜•ì‹ ìš”ì²­ (ì´ëª¨ì§€ í™œìš©)', 'ì¶”ê°€ ìš”ì†Œ (í¬ê¸° ë¹„êµ, ì•”ê¸°ë²•)']
                }
            ];

            const currentC = challenges[currentChallenge];

            useEffect(() => {
                setChatHistory([{ role: 'ai', text: `ì•ˆë…•í•˜ì„¸ìš”! ì–´ë–¤ ë‚´ìš©ì„ ë„ì™€ë“œë¦´ê¹Œìš”?` }]);
                setShowImproved(false);
            }, [currentChallenge]);

            const handleSendImproved = () => {
                setChatHistory(prev => [...prev, { role: 'user', text: currentC.improvedPrompt }]);
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.improvedResult }]);
                    setShowImproved(true);
                }, 800);
            };

            const handleNext = () => {
                if (currentChallenge < challenges.length - 1) {
                    setCurrentChallenge(currentChallenge + 1);
                } else {
                    markStageComplete('stage3');
                    goToStage(4);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">âœï¸</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-2">3ë‹¨ê³„: í”„ë¡¬í”„íŠ¸ ìˆ˜ì •í•˜ê¸°</h2>
                        <p className="text-purple-600 font-bold italic">"êµ¬ì²´ì ì´ê³  ëª…í™•í•œ ì§€ì‹œì˜ í˜ì„ í™•ì¸í•´ë³´ì„¸ìš”!"</p>
                    </div>

                    <div className="grid md:grid-cols-3 gap-6 mb-8">
                        <div className="md:col-span-1 space-y-4">
                            <div className="bg-red-50 border-2 border-red-200 rounded-2xl p-5">
                                <h4 className="font-bold text-red-800 mb-2">âŒ ê¸°ì¡´ í”„ë¡¬í”„íŠ¸</h4>
                                <p className="text-gray-700 bg-white p-3 rounded-lg text-sm">"{currentC.basicPrompt}"</p>
                            </div>
                            <div className="bg-green-50 border-2 border-green-200 rounded-2xl p-5">
                                <h4 className="font-bold text-green-800 mb-2">âœ… ê°œì„  í¬ì¸íŠ¸</h4>
                                <ul className="text-xs space-y-1 text-green-700">
                                    {currentC.suggestions.map((s, i) => <li key={i}>â€¢ {s}</li>)}
                                </ul>
                            </div>
                        </div>

                        <div className="md:col-span-2 chat-container p-6 flex flex-col h-[450px]">
                            <div className="flex-1 overflow-y-auto mb-4">
                                {chatHistory.map((chat, idx) => <ChatMessage key={idx} role={chat.role} text={chat.text} />)}
                            </div>
                            {!showImproved && (
                                <button onClick={handleSendImproved} className="bg-green-600 text-white py-4 rounded-xl font-bold hover:bg-green-700 transition-all shadow-lg">
                                    ğŸš€ ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ ì „ì†¡í•˜ê¸°
                                </button>
                            )}
                        </div>
                    </div>

                    {showImproved && (
                        <div className="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 fade-in">
                            <h4 className="font-bold text-blue-800 mb-2">âœ¨ ì°¨ì´ë¥¼ ë§Œë“  ìš”ì†Œ</h4>
                            <p className="text-gray-700 text-sm">êµ¬ì²´ì ì¸ ì¡°ê±´ê³¼ ëª…í™•í•œ ìš”êµ¬ì‚¬í•­ì„ ì¶”ê°€í•˜ë‹ˆ AIê°€ í›¨ì”¬ ë” ìƒì„¸í•˜ê³  ìœ ìš©í•œ ë‹µë³€ì„ ì œê³µí–ˆì–´ìš”! ì´ê²ƒì´ ë°”ë¡œ <b>í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</b>ì˜ í˜ì…ë‹ˆë‹¤.</p>
                            <button onClick={handleNext} className="w-full mt-6 bg-purple-600 text-white py-5 rounded-2xl font-bold text-xl">
                                {currentChallenge < challenges.length - 1 ? 'ë‹¤ìŒ ì±Œë¦°ì§€ âœ' : '4ë‹¨ê³„ë¡œ ì´ë™ âœ'}
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        /* 4~5ë‹¨ê³„ ë° ê¸°íƒ€ ì»´í¬ë„ŒíŠ¸ (ì´ì „ ì½”ë“œ ìœ ì§€) */
        function Stage4({ goToStage, updateScore, markStageComplete }) {
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [earnedScore, setEarnedScore] = useState(0);

            const questions = [
                {
                    id: 'q1',
                    aiResult: 'ğŸ“Š 2024ë…„ 1ë¶„ê¸° ì˜¨ë¼ì¸ ë§¤ì¶œ ë¶„ì„ ë³´ê³ ì„œ\n\nã€í•µì‹¬ ì§€í‘œã€‘\nâ€¢ ì´ ë§¤ì¶œ: 1ì–µ 2,300ë§Œì› (ì „ë…„ ëŒ€ë¹„ +23%)\nâ€¢ ì‹ ê·œ ê³ ê°: 1,247ëª… (ì „ë…„ ëŒ€ë¹„ +31%)\nâ€¢ ì¬êµ¬ë§¤ìœ¨: 42% (ì „ë…„ ëŒ€ë¹„ +5%p)\nâ€¢ í‰ê·  ê°ë‹¨ê°€: 98,600ì› (ì „ë…„ ëŒ€ë¹„ +8%)\n\nã€ì±„ë„ë³„ ë§¤ì¶œ ë¹„ì¤‘ã€‘\n1. ìì‚¬ëª°: 45% (5,535ë§Œì›)\n2. ë„¤ì´ë²„: 32% (3,936ë§Œì›)\n3. ì¿ íŒ¡: 23% (2,829ë§Œì›)\n\nã€ì¸ê¸° ìƒí’ˆ TOP 3ã€‘\n1. í”„ë¦¬ë¯¸ì—„ ìŠ¤í‚¨ì¼€ì–´ ì„¸íŠ¸ (2,340ë§Œì›)\n2. ë¹„íƒ€ë¯¼C ì„¸ëŸ¼ (1,890ë§Œì›)\n3. ìˆ˜ë¶„í¬ë¦¼ (1,560ë§Œì›)\n\nã€ê°œì„  ì œì•ˆã€‘\nâ€¢ ì¬êµ¬ë§¤ìœ¨ì´ ë†’ì€ ê³ ê°ì¸µ ì§‘ì¤‘ ê³µëµ\nâ€¢ ì¿ íŒ¡ ì±„ë„ ë§ˆì¼€íŒ… ê°•í™” í•„ìš”\nâ€¢ ì‹ ì œí’ˆ ì¶œì‹œë¡œ ê°ë‹¨ê°€ ìƒìŠ¹ ìœ ë„',
                    question: 'ì´ ë‹µë³€ì„ ë§Œë“  í”„ë¡¬í”„íŠ¸ëŠ”?',
                    options: [
                        { id: 'a', text: '1ë¶„ê¸° ë§¤ì¶œ ë°ì´í„°ë¥¼ ì •ë¦¬í•´ì„œ ë³´ê³ ì„œë¡œ ë§Œë“¤ì–´ì¤˜. ì „ë…„ ëŒ€ë¹„ ì¦ê°ë¥ ë„ ê³„ì‚°í•´ì¤˜', correct: false },
                        { id: 'b', text: '1ë¶„ê¸° ë§¤ì¶œ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì„œ ë³´ê³ ì„œë¡œ ë§Œë“¤ì–´ì¤˜. ì „ë…„ ëŒ€ë¹„ ì¦ê°ë¥ ê³¼ ê°œì„  ì œì•ˆë„ í¬í•¨í•´ì¤˜', correct: true }
                    ],
                    explanation: 'ì •ë‹µì…ë‹ˆë‹¤! ì‹¤ì œ ë‹µë³€ ë§¨ ì•„ë˜ì— ã€ê°œì„  ì œì•ˆã€‘ì„¹ì…˜ì´ ìˆì–´ìš”. AëŠ” ë°ì´í„°ë¥¼ "ì •ë¦¬"ë§Œ í–ˆì§€ë§Œ, BëŠ” "ë¶„ì„"í•˜ê³  "ê°œì„  ì œì•ˆ"ê¹Œì§€ ìš”ì²­í–ˆê¸° ë•Œë¬¸ì— ë” ìœ ìš©í•œ ë³´ê³ ì„œê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤.',
                    points: 20
                },
                {
                    id: 'q2',
                    aiResult: 'ğŸ” ì½”ë“œ ë¦¬ë·° ê²°ê³¼\n\nã€ê¸ì •ì ì¸ ë¶€ë¶„ã€‘\nâœ… ë³€ìˆ˜ëª…ì´ ì§ê´€ì ì´ê³  ì½ê¸° ì‰½ìŠµë‹ˆë‹¤\nâœ… í•¨ìˆ˜ê°€ ì‘ì€ ë‹¨ìœ„ë¡œ ì˜ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤\nâœ… ì£¼ì„ì´ ì ì ˆí•˜ê²Œ ì‘ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤\n\nã€ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ã€‘\n\n1ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±\n```python\n# í˜„ì¬\nresult = data / count\n\n# ê°œì„ \ntry:\n    result = data / count\nexcept ZeroDivisionError:\n    result = 0\n    logger.error("Division by zero")\n```\n\n2ï¸âƒ£ ì¤‘ë³µ ì½”ë“œ\nget_user_name()ê³¼ get_admin_name() í•¨ìˆ˜ê°€ ê±°ì˜ ë™ì¼í•©ë‹ˆë‹¤.\nâ†’ get_name(user_type) í•˜ë‚˜ë¡œ í†µí•©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.\n\n3ï¸âƒ£ ë¹„íš¨ìœ¨ì ì¸ ë°˜ë³µë¬¸\n```python\n# í˜„ì¬\nfor item in items:\n    if item.status == "active":\n        process(item)\n\n# ê°œì„ \nactive_items = filter(lambda x: x.status == "active", items)\nfor item in active_items:\n    process(item)\n```\n\nã€ì¢…í•© í‰ê°€ã€‘\nì „ì²´ì ìœ¼ë¡œ ê¹”ë”í•œ ì½”ë“œì´ë‚˜, ì˜ˆì™¸ ì²˜ë¦¬ì™€ ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤.\nì¶”ì²œ ë¦¬íŒ©í† ë§ ìš°ì„ ìˆœìœ„: ì—ëŸ¬ ì²˜ë¦¬ â†’ ì¤‘ë³µ ì œê±° â†’ ì„±ëŠ¥ ê°œì„ ',
                    question: 'ì´ ë‹µë³€ì„ ë§Œë“  í”„ë¡¬í”„íŠ¸ëŠ”?',
                    options: [
                        { id: 'a', text: 'Python ì½”ë“œë¥¼ ë¦¬ë·°í•´ì¤˜. ì¢‹ì€ ì ê³¼ ê°œì„ ì ì„ ë‚˜ëˆ ì„œ ì„¤ëª…í•˜ê³ , ê°œì„  ë¶€ë¶„ì€ Before/After ì½”ë“œë¡œ ë³´ì—¬ì¤˜', correct: true },
                        { id: 'b', text: 'Python ì½”ë“œë¥¼ ì „ë¬¸ì ìœ¼ë¡œ ë¦¬ë·°í•´ì¤˜. ì¢‹ì€ ì , ê°œì„ ì , ì‹¬ê°ë„ ë¶„ì„, ë¦¬íŒ©í† ë§ ìš°ì„ ìˆœìœ„, ë³´ì•ˆ ì·¨ì•½ì  ê²€í† , ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§, í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¶„ì„ì„ í¬í•¨í•˜ê³  ê° í•­ëª©ë§ˆë‹¤ Before/After ì½”ë“œì™€ ì„±ëŠ¥ ë¹„êµ ìˆ˜ì¹˜ë¥¼ ì œê³µí•´ì¤˜', correct: false }
                    ],
                    explanation: 'ì •ë‹µì…ë‹ˆë‹¤! ì‹¤ì œ ë‹µë³€ì€ ì¢‹ì€ ì , ê°œì„ ì , Before/After ì½”ë“œë¼ëŠ” "í•µì‹¬ ë‚´ìš©"ë§Œ ê°„ê²°í•˜ê²Œ ë‹´ê³  ìˆì–´ìš”. AëŠ” í•„ìš”í•œ ê²ƒë§Œ ìš”ì²­í•´ì„œ ëª…í™•í•œ ë¦¬ë·°ë¥¼ ë°›ì•˜ì§€ë§Œ, BëŠ” ë„ˆë¬´ ë§ì€ ê²ƒì„ ìš”ì²­í•´ì„œ ì˜¤íˆë ¤ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆì–´ìš”. ë•Œë¡œëŠ” ê°„ê²°í•œ í”„ë¡¬í”„íŠ¸ê°€ ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤!',
                    points: 20
                },
                {
                    id: 'q3',
                    aiResult: 'ğŸš€ "ë°˜ë ¤ë™ë¬¼ AI ê±´ê°•ê´€ë¦¬ ì•±" íˆ¬ì í”¼ì¹­\n\nã€ë¬¸ì œ ì •ì˜ã€‘\në°˜ë ¤ë™ë¬¼ì„ í‚¤ìš°ëŠ” 1,500ë§Œ ê°€êµ¬ ì¤‘ 70%ê°€ "ìš°ë¦¬ ì•„ì´ê°€ ì•„í”ˆì§€ ëª¨ë¥´ê² ë‹¤"ê³  ì‘ë‹µí–ˆìŠµë‹ˆë‹¤. ë™ë¬¼ë³‘ì› ë°©ë¬¸ ì‹œê¸°ë¥¼ ë†“ì³ ì¹˜ë£Œë¹„ê°€ 2ë°° ì´ìƒ ì¦ê°€í•˜ëŠ” ì‚¬ë¡€ê°€ ë¹ˆë²ˆí•©ë‹ˆë‹¤.\n\nã€ì†”ë£¨ì…˜ã€‘\nìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ë°˜ë ¤ë™ë¬¼ì˜ ëˆˆ, í”¼ë¶€, í–‰ë™ì„ ì´¬ì˜í•˜ë©´ AIê°€ ê±´ê°• ìƒíƒœë¥¼ ì‹¤ì‹œê°„ ë¶„ì„í•˜ê³ , ì´ìƒ ì§•í›„ ë°œê²¬ ì‹œ ì¦‰ì‹œ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.\n\nã€í•µì‹¬ ê¸°ëŠ¥ã€‘\nâ€¢ AI ê±´ê°• ìŠ¤ìº” (ì •í™•ë„ 94%)\nâ€¢ ì¦ìƒë³„ ëŒ€ì²˜ë²• ê°€ì´ë“œ\nâ€¢ ê·¼ì²˜ ë™ë¬¼ë³‘ì› ì˜ˆì•½ ì—°ê²°\nâ€¢ ê±´ê°• ê¸°ë¡ ìë™ ì €ì¥\n\nã€ì‹œì¥ ë¶„ì„ã€‘\nâ€¢ êµ­ë‚´ í«ì¼€ì–´ ì‹œì¥: 6ì¡°ì› (ì—° 15% ì„±ì¥)\nâ€¢ ê²½ìŸ ì•± ëŒ€ë¹„ ì°¨ë³„ì : AI ì •í™•ë„ 1ìœ„, ìˆ˜ì˜ì‚¬ í˜‘ì—…\n\nã€ìˆ˜ìµ ëª¨ë¸ã€‘\n1. í”„ë¦¬ë¯¸ì—„ êµ¬ë…: ì›” 9,900ì› (ë¬´ì œí•œ ìŠ¤ìº”)\n2. ë³‘ì› ì˜ˆì•½ ìˆ˜ìˆ˜ë£Œ: ê±´ë‹¹ 3,000ì›\n3. ë§ì¶¤ ì˜ì–‘ì œ íŒë§¤: í‰ê·  25% ìˆ˜ìµë¥ \n\nã€ëª©í‘œã€‘\nâ€¢ 1ë…„ì°¨: ì‚¬ìš©ì 10ë§Œëª…, ì›” ë§¤ì¶œ 5,000ë§Œì›\nâ€¢ 3ë…„ì°¨: ì‚¬ìš©ì 100ë§Œëª…, ì—° ë§¤ì¶œ 100ì–µì›\n\nã€íˆ¬ì ìš”ì²­ã€‘\nì‹œë“œ íˆ¬ì 5ì–µì›ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì •ì‹ ì¶œì‹œ ë° ë§ˆì¼€íŒ…\nì˜ˆìƒ ROI: 3ë…„ ë‚´ 10ë°° ì´ìƒ',
                    question: 'ì´ ë‹µë³€ì„ ë§Œë“  í”„ë¡¬í”„íŠ¸ëŠ”?',
                    options: [
                        { id: 'a', text: 'ë°˜ë ¤ë™ë¬¼ AI ì•± íˆ¬ì í”¼ì¹­ ìë£Œë¥¼ ë§Œë“¤ì–´ì¤˜. ë¬¸ì œ, ì†”ë£¨ì…˜, ì‹œì¥ ë¶„ì„, ì°¨ë³„ì ì„ í¬í•¨í•´ì¤˜', correct: false },
                        { id: 'b', text: 'ë°˜ë ¤ë™ë¬¼ AI ì•± íˆ¬ì í”¼ì¹­ ìë£Œë¥¼ ë§Œë“¤ì–´ì¤˜. ë¬¸ì œ, ì†”ë£¨ì…˜, ì‹œì¥ ë¶„ì„ê³¼ í•¨ê»˜ êµ¬ì²´ì ì¸ ìˆ˜ìµ ëª¨ë¸ê³¼ ëª©í‘œ ìˆ˜ì¹˜ë¥¼ í¬í•¨í•´ì¤˜', correct: true }
                    ],
                    explanation: 'ì •ë‹µì…ë‹ˆë‹¤! ì‹¤ì œ ë‹µë³€ì—ëŠ” ã€ìˆ˜ìµ ëª¨ë¸ã€‘(êµ¬ë… 9,900ì›, ìˆ˜ìˆ˜ë£Œ 3,000ì›)ê³¼ ã€ëª©í‘œã€‘(1ë…„ì°¨ 10ë§Œëª…, 3ë…„ì°¨ 100ë§Œëª…) ì„¹ì…˜ì´ êµ¬ì²´ì  ìˆ«ìì™€ í•¨ê»˜ ìˆì–´ìš”. AëŠ” ì¶”ìƒì  ë‚´ìš©ë§Œ ìš”ì²­í–ˆì§€ë§Œ, BëŠ” "êµ¬ì²´ì  ìˆ˜ìµ ëª¨ë¸ê³¼ ëª©í‘œ ìˆ˜ì¹˜"ë¥¼ ìš”ì²­í–ˆê¸° ë•Œë¬¸ì— íˆ¬ììë¥¼ ì„¤ë“í•  ìˆ˜ ìˆëŠ” ìë£Œê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤.',
                    points: 20
                }
            ];

            const currentQ = questions[currentQuestion];

            const handleAnswer = (optionId) => {
                if (showFeedback) return;
                setSelectedAnswer(optionId);
                setShowFeedback(true);
                const option = currentQ.options.find(o => o.id === optionId);
                if (option.correct) {
                    updateScore(currentQ.points);
                    setEarnedScore(prev => prev + currentQ.points);
                }
            };

            const handleNext = () => {
                if (currentQuestion < questions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                    setSelectedAnswer(null);
                    setShowFeedback(false);
                } else {
                    markStageComplete('stage4');
                    goToStage(5);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">ğŸ¯</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">4ë‹¨ê³„: í”„ë¡¬í”„íŠ¸ ì¶”ë¡ í•˜ê¸°</h2>
                        <div className="mt-4 inline-block bg-purple-100 px-4 py-2 rounded-full font-bold text-purple-800">íšë“ ì ìˆ˜: {earnedScore}ì  / 60ì </div>
                    </div>
                    <div className="bg-gray-50 border-2 border-gray-200 rounded-2xl p-6 mb-6">
                        <div className="flex items-center mb-4">
                            <span className="text-2xl mr-2">ğŸ¤–</span>
                            <span className="font-bold text-gray-700">AIì˜ ë‹µë³€ ê²°ê³¼:</span>
                        </div>
                        <div className="bg-white p-5 rounded-xl text-sm whitespace-pre-line border border-gray-200 leading-relaxed max-h-[300px] overflow-y-auto">
                            {currentQ.aiResult}
                        </div>
                    </div>
                    <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">{currentQ.question}</h3>
                    <div className="space-y-3">
                        {currentQ.options.map((option, idx) => (
                            <button key={option.id} onClick={() => handleAnswer(option.id)} disabled={showFeedback}
                                className={`w-full text-left p-5 rounded-xl border-2 transition-all ${
                                    showFeedback ? (option.correct ? 'bg-green-100 border-green-500' : (option.id === selectedAnswer ? 'bg-red-100 border-red-500' : 'bg-gray-50 border-gray-200'))
                                    : 'bg-white border-gray-300 hover:border-purple-400'
                                }`}>
                                <span className="font-bold mr-3">{idx + 1}.</span> {option.text}
                            </button>
                        ))}
                    </div>
                    {showFeedback && (
                        <div className="mt-6 p-6 bg-gray-50 border-2 border-dashed border-gray-300 rounded-2xl">
                            <p className="text-gray-800 leading-relaxed">{currentQ.explanation}</p>
                            <button onClick={handleNext} className="w-full mt-4 bg-purple-600 text-white py-4 rounded-xl font-bold">ë‹¤ìŒ ë¬¸ì œ âœ</button>
                        </div>
                    )}
                </div>
            );
        }

        function Stage5({ totalScore, setAllStagesCompleted }) {
            const certRef = useRef(null);
            const [checkedItems, setCheckedItems] = useState({});
            const keyLearnings = [
                { id: 'l1', title: 'ëª…í™•ì„± (Clarity)', desc: 'í”„ë¡¬í”„íŠ¸ëŠ” ëª…í™•í•˜ê³  êµ¬ì²´ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ëª¨í˜¸í•œ í‘œí˜„ì€ ëª¨í˜¸í•œ ê²°ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.' },
                { id: 'l2', title: 'êµ¬ì²´ì„± (Specificity)', desc: 'ëŒ€ìƒ, ë¶„ëŸ‰, í˜•ì‹, í†¤ ë“± êµ¬ì²´ì ì¸ ì¡°ê±´ì„ ëª…ì‹œí•˜ë©´ ë” ë§ì¶¤í™”ëœ ë‹µë³€ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
                { id: 'l3', title: 'ë‹¨ê³„ì  ì§€ì‹œ (Step-by-step)', desc: 'ë³µì¡í•œ ì‘ì—…ì€ ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ„ì–´ ì§€ì‹œí•˜ë©´ AIê°€ ë” ì²´ê³„ì ìœ¼ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.' },
                { id: 'l4', title: 'ì˜ˆì‹œ ì œê³µ (Examples)', desc: 'ì›í•˜ëŠ” í˜•ì‹ì´ë‚˜ ìŠ¤íƒ€ì¼ì˜ ì˜ˆì‹œë¥¼ ì œê³µí•˜ë©´ AIê°€ ë” ì •í™•í•˜ê²Œ ì´í•´í•©ë‹ˆë‹¤.' },
                { id: 'l5', title: 'ë°˜ë³µì  ê°œì„  (Iteration)', desc: 'ì²« ë²ˆì§¸ ê²°ê³¼ê°€ ë§Œì¡±ìŠ¤ëŸ½ì§€ ì•Šë‹¤ë©´ í”„ë¡¬í”„íŠ¸ë¥¼ ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.' }
            ];

            const handleCheckItem = (id) => setCheckedItems(prev => ({ ...prev, [id]: !prev[id] }));
            const allChecked = Object.keys(checkedItems).length === keyLearnings.length && Object.values(checkedItems).every(v => v);

            useEffect(() => { if (allChecked) { setAllStagesCompleted(true); } }, [allChecked]);

            let level = '', emoji = '', rank = '', comment = '';
            if (totalScore >= 80) { level = 'í”„ë¡¬í”„íŠ¸ ë§ˆìŠ¤í„°'; emoji = 'ğŸ†'; rank = 'MASTER'; comment = 'ìµœê³  ìˆ˜ì¤€!'; }
            else if (totalScore >= 60) { level = 'í”„ë¡¬í”„íŠ¸ ì „ë¬¸ê°€'; emoji = 'ğŸ“'; rank = 'EXPERT'; comment = 'ë›°ì–´ë‚œ ì‹¤ë ¥!'; }
            else { level = 'í”„ë¡¬í”„íŠ¸ í•™ìŠµì'; emoji = 'ğŸŒ±'; rank = 'BEGINNER'; comment = 'ì¢‹ì€ ì¶œë°œ!'; }

            const downloadCert = () => {
                html2canvas(certRef.current, { scale: 2, backgroundColor: '#ffffff' }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'í”„ë¡¬í”„íŠ¸ì±Œë¦°ì§€_ì¸ì¦ì„œ.png';
                    link.href = canvas.toDataURL();
                    link.click();
                });
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-7xl mb-6 bounce">ğŸ†</div>
                        <h2 className="text-4xl font-bold text-gray-800 mb-6">ì±Œë¦°ì§€ ì™„ë£Œ!</h2>
                    </div>
                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 border-2 border-purple-200 mb-6">
                        <h3 className="text-2xl font-bold text-purple-800 mb-4 text-center">ğŸ“š ì¢‹ì€ í”„ë¡¬í”„íŠ¸ì˜ 5ê°€ì§€ ì¡°ê±´</h3>
                        <div className="space-y-4">
                            {keyLearnings.map(item => (
                                <div key={item.id} onClick={() => handleCheckItem(item.id)} className={`bg-white rounded-xl p-5 flex items-start cursor-pointer border-2 transition-all ${checkedItems[item.id] ? 'border-green-300 bg-green-50' : 'border-gray-100 hover:border-purple-200'}`}>
                                    <div className={`w-6 h-6 rounded border-2 mr-4 flex items-center justify-center ${checkedItems[item.id] ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}>{checkedItems[item.id] && 'âœ“'}</div>
                                    <div><h4 className="font-bold">{item.title}</h4><p className="text-sm text-gray-600">{item.desc}</p></div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div ref={certRef} className="bg-white rounded-3xl p-10 mb-8 border-4 border-double border-purple-300 text-center shadow-lg">
                        <div className="text-6xl mb-4">{emoji}</div>
                        <h3 className="text-3xl font-bold text-purple-800 mb-4">í”„ë¡¬í”„íŠ¸ ì±Œë¦°ì§€ ì¸ì¦ì„œ</h3>
                        <input type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" className="text-2xl font-bold text-center w-full border-b-2 border-yellow-400 mb-6 outline-none" />
                        <p className="text-gray-700 mb-8">ìœ„ ì‚¬ëŒì€ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì‹¤ìŠµì„ í†µí•´<br/>AI í™œìš© ëŠ¥ë ¥ì„ ì„±ê³µì ìœ¼ë¡œ í–¥ìƒí–ˆìŒì„ ì¦ëª…í•©ë‹ˆë‹¤.</p>
                        <div className="flex justify-center gap-4 mb-4">
                            <div className="bg-purple-100 px-6 py-4 rounded-2xl"><div className="text-xs text-purple-600">ìµœì¢… ì ìˆ˜</div><div className="text-3xl font-bold text-purple-800">{totalScore}ì </div></div>
                            <div className="bg-yellow-100 px-6 py-4 rounded-2xl"><div className="text-xs text-yellow-600">ë ˆë²¨</div><div className="text-3xl font-bold text-yellow-800">{rank}</div></div>
                        </div>
                        <p className="text-gray-400 text-sm">{new Date().toLocaleDateString()}</p>
                    </div>
                    <button onClick={downloadCert} className="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white text-xl font-bold py-5 rounded-2xl shadow-xl hover:scale-[1.02] transition-all">ğŸ“¥ ì¸ì¦ì„œ ë‹¤ìš´ë¡œë“œ</button>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<PromptChallenge />);
    </script>
</body>
</html>