<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프롬프트 챌린지</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"제></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .bounce { animation: bounce 0.5s ease; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .chat-container { background: #f3f4f6; border-radius: 1.5rem; overflow: hidden; border: 1px solid #e5e7eb; }
        .chat-bubble-ai { background: white; border-radius: 0 1rem 1rem 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .chat-bubble-user { background: #6366f1; color: white; border-radius: 1rem 1rem 0 1rem; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const MAX_SCORE = 140; 

        function ChatMessage({ role, text, icon, image }) {
            return (
                <div className={`flex ${role === 'user' ? 'justify-end' : 'justify-start'} mb-4 fade-in`}>
                    {role === 'ai' && <div className="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center mr-2 flex-shrink-0 text-sm">🤖</div>}
                    <div className={`max-w-[80%] p-4 ${role === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}`}>
                        <p className="text-sm whitespace-pre-line leading-relaxed">{text}</p>
                        {image && <img src={image} alt="result" className="mt-3 rounded-lg max-w-xs h-auto shadow-sm border border-gray-100 mx-auto" />}
                    </div>
                    {role === 'user' && <div className="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center ml-2 flex-shrink-0 text-sm text-white">👤</div>}
                </div>
            );
        }

        function PromptChallenge() {
            const [stage, setStage] = useState(0);
            const [totalScore, setTotalScore] = useState(0);
            const [maxReachedStage, setMaxReachedStage] = useState(0);
            const [completedStages, setCompletedStages] = useState({
                stage1: false, stage2: false, stage3: false, stage4: false
            });
            const [allStagesCompleted, setAllStagesCompleted] = useState(false);
            
            const updateScore = (points) => {
                setTotalScore(prev => prev + points);
            };
            
            const goToStage = (stageNum) => setStage(stageNum);

            useEffect(() => {
                if (stage > maxReachedStage) {
                    setMaxReachedStage(stage);
                }
            }, [stage]);

            const markStageComplete = (stageKey) => {
                setCompletedStages(prev => ({ ...prev, [stageKey]: true }));
            };

            const stages = [
                { component: IntroStage },
                { component: Stage1 },
                { component: Stage2 },
                { component: Stage3 },
                { component: Stage4 },
                { component: Stage5 }
            ];
            const CurrentComponent = stages[stage].component;

            return (
                <div className="min-h-screen py-8 px-4">
                    <div className="max-w-5xl mx-auto">
                        <div className="text-center mb-6 fade-in">
                            <h1 className="text-4xl md:text-5xl font-bold text-white mb-4">🎯 프롬프트 챌린지</h1>
                            <p className="text-xl text-white opacity-90">더 좋은 문장 만들기</p>
                        </div>
                        {stage > 0 && (
                            <div className="mb-6 no-print">
                                <div className="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm mb-4">
                                    <div className="flex justify-between items-center">
                                        <div className="text-white font-bold text-lg">
                                            🏆 점수: <span className="text-yellow-300 text-2xl">{totalScore}</span> / {MAX_SCORE}점
                                        </div>
                                        <div className="text-white font-bold text-lg">📍 {stage}/5 단계</div>
                                    </div>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-2xl p-4 backdrop-blur-sm">
                                    <div className="flex justify-around items-center">
                                        {['기본 결과', '문제 발견', '수정하기', '프롬프트 추론', '결과 확인'].map((title, idx) => {
                                            const stageNum = idx + 1;
                                            const isCurrentStage = stageNum === stage;
                                            const isCompleted = completedStages[`stage${stageNum}`] || (stageNum === 5 && allStagesCompleted);
                                            const canAccess = stageNum <= maxReachedStage || allStagesCompleted;
                                            
                                            return (
                                                <button key={idx} onClick={() => goToStage(stageNum)}
                                                    disabled={!canAccess}
                                                    className={`flex flex-col items-center px-2 py-2 rounded-xl transition-all duration-300 ${
                                                        isCurrentStage ? 'bg-purple-500 text-white scale-110 shadow-lg ring-2 ring-white ring-opacity-50'
                                                        : isCompleted ? 'bg-lime-400 text-white hover:scale-105'
                                                        : canAccess ? 'bg-white bg-opacity-40 text-white hover:bg-opacity-60 hover:scale-105'
                                                        : 'bg-white bg-opacity-30 text-white opacity-50 cursor-not-allowed'
                                                    }`}>
                                                    <div className="text-lg mb-1">
                                                        {isCompleted ? '✓' : isCurrentStage ? '▶' : stageNum}
                                                    </div>
                                                    <div className="text-xs font-bold">{title}</div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}
                        <CurrentComponent
                            goToStage={goToStage} 
                            updateScore={updateScore} 
                            totalScore={totalScore}
                            markStageComplete={markStageComplete}
                            setAllStagesCompleted={setAllStagesCompleted}
                        />
                    </div>
                </div>
            );
        }

        function IntroStage({ goToStage }) {
            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">🚀</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">프롬프트 챌린지에 도전하세요!</h2>
                        <p className="text-lg text-gray-600 leading-relaxed mb-6">
                            프롬프트를 개선하는 실습을 통해<br/>AI를 더 효과적으로 활용하는 방법을 배워봅시다!
                        </p>
                    </div>

                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 mb-8 border-2 border-purple-200">
                        <h3 className="text-xl font-bold text-purple-800 mb-4">🎯 학습 목표</h3>
                        <div className="space-y-3 text-left">
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">🔍</span>
                                <p className="text-gray-700 flex-1"><span className="font-bold">프롬프트의 문제점</span>을 스스로 발견할 수 있다</p>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">✏️</span>
                                <p className="text-gray-700 flex-1"><span className="font-bold">프롬프트를 개선</span>하여 더 나은 결과를 얻을 수 있다</p>
                            </div>
                            <div className="flex items-start">
                                <span className="text-2xl mr-3">⚡</span>
                                <p className="text-gray-700 flex-1"><span className="font-bold">프롬프트 엔지니어링</span>의 실전 기술을 익힐 수 있다</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl p-6 mb-8 border-2 border-blue-200">
                        <h3 className="text-xl font-bold text-blue-800 mb-4">🗺️ 챌린지 과정</h3>
                        <div className="grid md:grid-cols-5 gap-3">
                            {[
                                { icon: '📝', title: '1단계', desc: '기본 결과' },
                                { icon: '🔍', title: '2단계', desc: '문제 발견' },
                                { icon: '✏️', title: '3단계', desc: '수정하기' },
                                { icon: '🎯', title: '4단계', desc: '추론하기' },
                                { icon: '🎓', title: '5단계', desc: '결과 확인' }
                            ].map((step, idx) => (
                                <div key={idx} className="bg-white rounded-xl p-3 text-center">
                                    <div className="text-2xl mb-1">{step.icon}</div>
                                    <div className="font-bold text-gray-800 text-xs mb-1">{step.title}</div>
                                    <div className="text-xs text-gray-600">{step.desc}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <button onClick={() => goToStage(1)}
                        className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xl font-bold py-5 px-8 rounded-2xl hover:shadow-2xl transform hover:scale-105 transition-all">
                        🎯 챌린지 시작하기
                    </button>
                </div>
            );
        }

        function Stage1({ goToStage, markStageComplete }) {
            const [currentChallenge, setCurrentChallenge] = useState(0);
            const [chatHistory, setChatHistory] = useState([]);
            const [showAnalysis, setShowAnalysis] = useState(false);

            const challenges = [
                {
                    id: 'c1',
                    topic: '이미지 생성 요청',
                    basicPrompt: '귀여운 강아지가 풀밭에서 노는 그림 그려줘',
                    basicResult: '요청하신 귀여운 강아지가 풀밭에 있는 이미지입니다.',
                    image: 'https://raw.githubusercontent.com/comthatit/aisource/refs/heads/main/dog1.png?auto=format&fit=crop&q=80&w=800',
                    feedback: {
                        problem: '기본 정보는 있지만 여전히 많이 부족해요.',
                        issues: ['강아지의 품종이 명시되지 않음', '어떤 행동인지 불명확 ("노는"이 애매함)', '시간대나 날씨 같은 분위기 없음', '그림 스타일이 지정되지 않음'],
                        improvement: {
                            example: '"골든 리트리버가 햇살 가득한 공원 잔디밭에서 빨간 공을 물고 뛰어가는 모습을 따뜻한 느낌의 수채화 스타일로 그려줘"',
                            why: '품종(골든 리트리버), 장소(햇살 가득한 공원 잔디밭), 구체적 행동(빨간 공을 물고 뛰어감), 스타일(따뜻한 수채화)을 모두 명시하면 정확히 원하는 그림을 얻을 수 있어요!'
                        },
                        nextStep: '이미지 생성에는 "무엇을", "어디서", "어떻게", "어떤 스타일로"가 모두 필요해요. 다음 단계에서 이런 요소들이 왜 중요한지 배워봅시다!'
                    }
                },
                {
                    id: 'c2',
                    topic: '번역 요청',
                    basicPrompt: '이 문장을 영어로 번역해줘: 안녕하세요',
                    basicResult: 'Hello',
                    feedback: {
                        problem: '번역할 텍스트는 있지만 맥락이 없어요.',
                        issues: ['어떤 상황에서 쓰는지 불명확', '격식 수준이 명시되지 않음', '번역의 목적이 없음'],
                        improvement: {
                            example: '"\'안녕하세요, 만나서 반갑습니다\'를 비즈니스 미팅 상황에서 사용할 수 있는 정중하고 격식있는 영어로 번역해줘"',
                            why: '사용 상황(비즈니스 미팅), 톤(정중하고 격식있는)을 명시하면 상황에 딱 맞는 번역을 얻을 수 있어요!'
                        },
                        nextStep: '같은 "안녕하세요"도 친구에게, 고객에게, 교수님께 쓸 때 모두 달라요. 번역도 마찬가지로 맥락이 중요합니다. 다음 단계에서 더 알아봅시다!'
                    }
                },
                {
                    id: 'c3',
                    topic: '이메일 작성',
                    basicPrompt: '고객에게 보낼 감사 이메일 써줘',
                    basicResult: '고객님께\n\n감사합니다.\n\n담당자 드림',
                    feedback: {
                        problem: '대상과 목적은 있지만 구체적 내용이 없어요.',
                        issues: ['무엇에 대한 감사인지 불명확', '어떤 상황인지 모름', '이메일 길이나 구조 미명시', '후속 행동이 있는지 불명확'],
                        improvement: {
                            example: '"신제품 구매해주신 고객에게 보낼 감사 이메일을 정중하게 작성해줘. 구매 감사 인사와 함께 다음 구매 시 사용 가능한 10% 할인 쿠폰을 안내하는 내용을 포함해줘"',
                            why: '구체적 상황(신제품 구매), 톤(정중하게), 핵심 내용(감사+할인 쿠폰 안내)을 명시하면 실제 사용 가능한 이메일을 얻어요!'
                        },
                        nextStep: 'AI는 마음을 읽을 수 없어요! "감사 이메일"이라고만 하면 무엇에 감사하는지, 어떤 내용을 담을지 알 수 없죠. 다음 단계에서 명확한 지시의 힘을 경험해봅시다!'
                    }
                }
            ];

            const currentC = challenges[currentChallenge];

            useEffect(() => {
                setChatHistory([{ role: 'ai', text: `안녕하세요! "${currentC.topic}"에 대한 프롬프트를 입력해보세요.` }]);
                setShowAnalysis(false);
            }, [currentChallenge]);

            const handleSendPrompt = () => {
                const newHistory = [
                    ...chatHistory,
                    { role: 'user', text: currentC.basicPrompt }
                ];
                setChatHistory(newHistory);
                
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.basicResult, image: currentC.image }]);
                    setShowAnalysis(true);
                }, 800);
            };

            const handleNext = () => {
                if (currentChallenge < challenges.length - 1) {
                    setCurrentChallenge(currentChallenge + 1);
                } else {
                    markStageComplete('stage1');
                    goToStage(2);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">📝</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">1단계: 기본 프롬프트 결과 확인</h2>
                        <p className="text-gray-600 mb-2">챌린지 {currentChallenge + 1} / {challenges.length}</p>
                    </div>

                    <div className="chat-container mb-8 p-6 flex flex-col min-h-[400px]">
                        <div className="flex-1 overflow-y-auto mb-4">
                            {chatHistory.map((chat, idx) => (
                                <ChatMessage key={idx} role={chat.role} text={chat.text} image={chat.image} />
                            ))}
                        </div>
                        
                        {!showAnalysis && (
                            <div className="flex gap-2 bg-white p-2 rounded-2xl border-2 border-purple-200">
                                <div className="flex-1 p-3 text-gray-400 text-sm">"{currentC.basicPrompt}" 라고 입력하기</div>
                                <button onClick={handleSendPrompt} className="bg-purple-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-purple-700 transition-colors">전송</button>
                            </div>
                        )}
                    </div>

                    {showAnalysis && (
                        <div className="space-y-6 fade-in">
                            <div className="bg-red-50 rounded-xl p-6 border-2 border-red-300">
                                <h4 className="font-bold text-red-800 text-lg mb-3">⚠️ {currentC.feedback.problem}</h4>
                                <div className="grid md:grid-cols-2 gap-2">
                                    {currentC.feedback.issues.map((issue, idx) => (
                                        <div key={idx} className="flex items-center bg-white rounded-lg p-3">
                                            <span className="text-red-500 mr-2">✗</span>
                                            <span className="text-sm text-gray-700">{issue}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-green-50 rounded-xl p-6 border-2 border-green-300">
                                <h4 className="font-bold text-green-800 text-lg mb-3">💡 개선 방법</h4>
                                <div className="bg-white rounded-lg p-4 mb-4 border-l-4 border-green-500">
                                    <p className="text-xs text-gray-600 mb-1">✅ 개선된 프롬프트 예시:</p>
                                    <p className="text-gray-800 font-medium">{currentC.feedback.improvement.example}</p>
                                </div>
                                <p className="text-sm text-gray-700">{currentC.feedback.improvement.why}</p>
                            </div>

                            <button onClick={handleNext} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xl font-bold py-5 rounded-2xl">
                                {currentChallenge < challenges.length - 1 ? '다음 챌린지 ➜' : '2단계로 이동 ➜'}
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        function Stage2({ goToStage, updateScore, markStageComplete }) {
            const [currentChallenge, setCurrentChallenge] = useState(0);
            const [isChatted, setIsChatted] = useState(false);
            const [chatHistory, setChatHistory] = useState([]);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [earnedScore, setEarnedScore] = useState(0);

            const challenges = [
                {
                    id: 'c1',
                    topic: '블로그 포스팅',
                    basicPrompt: '블로그 글 써줘',
                    aiResult: '제목\n내용\n마무리',
                    question: '이 프롬프트의 가장 큰 문제점은?',
                    options: [
                        { id: 'a', text: '제목을 미리 정하지 않았다', correct: false },
                        { id: 'b', text: '어떤 주제에 대해 쓸지, 누구를 위한 글인지 명시하지 않았다', correct: true },
                        { id: 'c', text: '글자 수를 지정하지 않았다', correct: false },
                        { id: 'd', text: '사용할 이미지를 지정하지 않았다', correct: false }
                    ],
                    explanation: 'AI는 무엇에 대해(주제), 누구를 위해(타겟 독자), 어떤 느낌으로(톤) 쓸지를 알아야 의미있는 글을 작성할 수 있어요.',
                    points: 15
                },
                {
                    id: 'c2',
                    topic: '회의록 작성',
                    basicPrompt: '회의록 만들어줘',
                    aiResult: '회의 일시:\n참석자:\n내용:',
                    question: '이 프롬프트의 가장 큰 문제점은?',
                    options: [
                        { id: 'a', text: '회의실 위치가 명시되지 않았다', correct: false },
                        { id: 'b', text: '회의 시간이 몇 시간인지 안 적었다', correct: false },
                        { id: 'c', text: '회의에서 무엇을 논의했는지, 어떤 결정이 났는지 내용이 없다', correct: true },
                        { id: 'd', text: '회의 참석자 이름을 안 적었다', correct: false }
                    ],
                    explanation: '회의의 실제 내용(논의 사항, 결정 사항)이 없으면 AI가 빈 틀만 만들 수밖에 없어요.',
                    points: 15
                },
                {
                    id: 'c3',
                    topic: '상품 리뷰',
                    basicPrompt: '제품 리뷰 써줘',
                    aiResult: '이 제품은 좋습니다.',
                    question: '이 프롬프트에 꼭 필요한 정보는?',
                    options: [
                        { id: 'a', text: '영수증 번호', correct: false },
                        { id: 'b', text: '제조사 위치', correct: false },
                        { id: 'c', text: '제품 종류, 장단점', correct: true },
                        { id: 'd', text: '제품을 산 날짜', correct: false }
                    ],
                    explanation: '어떤 제품인지, 실제 사용 경험과 장단점을 알려줘야 AI가 실질적인 리뷰를 작성할 수 있어요.',
                    points: 10
                }
            ];

            const currentC = challenges[currentChallenge];

            useEffect(() => {
                setChatHistory([{ role: 'ai', text: `무엇을 도와드릴까요?` }]);
                setIsChatted(false);
                setShowFeedback(false);
                setSelectedAnswer(null);
            }, [currentChallenge]);

            const startChat = () => {
                setChatHistory(prev => [...prev, { role: 'user', text: currentC.basicPrompt }]);
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.aiResult }]);
                    setIsChatted(true);
                }, 800);
            };

            const handleAnswer = (optionId) => {
                if (showFeedback) return;
                setSelectedAnswer(optionId);
                setShowFeedback(true);
                const option = currentC.options.find(o => o.id === optionId);
                if (option.correct) {
                    updateScore(currentC.points);
                    setEarnedScore(prev => prev + currentC.points);
                }
            };

            const handleNext = () => {
                if (currentChallenge < challenges.length - 1) {
                    setCurrentChallenge(currentChallenge + 1);
                } else {
                    markStageComplete('stage2');
                    goToStage(3);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">🔍</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">2단계: 프롬프트의 문제점 찾기</h2>
                        <div className="mt-2 inline-block bg-purple-100 px-4 py-1 rounded-full text-purple-800 font-bold">획득 점수: {earnedScore}점</div>
                    </div>

                    <div className="chat-container mb-8 p-6 flex flex-col min-h-[300px]">
                        <div className="flex-1 overflow-y-auto mb-4">
                            {chatHistory.map((chat, idx) => (
                                <ChatMessage key={idx} role={chat.role} text={chat.text} />
                            ))}
                        </div>
                        {!isChatted && (
                            <button onClick={startChat} className="bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all">
                                💬 "{currentC.basicPrompt}" 입력하고 결과 보기
                            </button>
                        )}
                    </div>

                    {isChatted && (
                        <div className="fade-in">
                            <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">🤔 {currentC.question}</h3>
                            <div className="space-y-3 mb-6">
                                {currentC.options.map((option) => (
                                    <button key={option.id} onClick={() => handleAnswer(option.id)} disabled={showFeedback}
                                        className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                                            showFeedback ? (option.correct ? 'bg-green-100 border-green-500' : (option.id === selectedAnswer ? 'bg-red-100 border-red-500' : 'bg-gray-50 border-gray-200'))
                                            : 'bg-white border-gray-300 hover:border-purple-400'
                                        }`}>
                                        <span className="font-bold mr-3">{option.id.toUpperCase()}.</span> {option.text}
                                    </button>
                                ))}
                            </div>
                            {showFeedback && (
                                <div className={`p-6 rounded-2xl mb-6 border-2 ${currentC.options.find(o => o.id === selectedAnswer)?.correct ? 'bg-green-50 border-green-200' : 'bg-orange-50 border-orange-200'}`}>
                                    <p className="font-bold mb-2">
                                        {currentC.options.find(o => o.id === selectedAnswer)?.correct ? '🎉 정답입니다!' : '💡 오답입니다. 다시 확인해볼까요?'}
                                    </p>
                                    <p className="text-gray-700">{currentC.explanation}</p>
                                    <button onClick={handleNext} className="w-full mt-4 bg-purple-600 text-white py-4 rounded-xl font-bold">
                                        {currentChallenge < challenges.length - 1 ? '다음 문제 ➜' : '3단계로 이동 ➜'}
                                    </button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        function Stage3({ goToStage, markStageComplete }) {
            const [currentChallenge, setCurrentChallenge] = useState(0);
            const [chatHistory, setChatHistory] = useState([]);
            const [stepInChallenge, setStepInChallenge] = useState(0);

            const challenges = [
                {
                    id: 'c1',
                    topic: '인스타그램 캡션',
                    basicPrompt: '인스타 글 써줘',
                    basicResult: '즐거운 하루입니다. #일상 #소통 #좋아요',
                    improvedPrompt: '카페 창업 3주년을 축하하는 인스타그램 캡션을 써줘. 감사 인사와 함께 이번 주 특별 이벤트(아메리카노 1+1)를 자연스럽게 홍보하고, 해시태그 5개 포함해줘. 친근하고 따뜻한 톤으로',
                    improvedResult: '우리 카페가 벌써 3주년을 맞이했어요! 🎉\n\n항상 찾아주시는 모든 분들 덕분에 여기까지 올 수 있었어요. 진심으로 감사드립니다 ☕️💕\n\n감사의 마음을 담아 이번 주 내내 아메리카노 1+1 이벤트를 진행해요! 소중한 분과 함께 맛있는 커피 한 잔 어떠세요?\n\n앞으로도 더 좋은 커피와 따뜻한 공간으로 찾아뵐게요 🌟\n\n#카페3주년 #감사이벤트 #아메리카노1+1 #동네카페 #커피스타그램',
                    suggestions: ['목적 명시 (3주년 축하)', '구체적 이벤트 (아메리카노 1+1)', '톤 지정 (친근하고 따뜻하게)', '형식 요청 (해시태그 5개)'],
                    summaryFeedback: '단순히 "글 써줘"라고 하기보다 인스타그램처럼 플랫폼의 특성에 맞는 톤과 해시태그 개수, 홍보할 이벤트를 정확히 짚어주는 것이 핵심입니다.'
                },
                {
                    id: 'c2',
                    topic: '간편 요리 레시피',
                    basicPrompt: '요리 레시피 알려줘',
                    basicResult: '1. 재료를 준비한다. 2. 냄비에 넣고 끓인다. 3. 간을 맞춘다.',
                    improvedPrompt: '혼자 사는 직장인을 위한 10분 완성 김치볶음밥 레시피를 알려줘. 1인분 기준으로 재료와 분량을 명시하고, 요리 초보도 따라할 수 있게 각 단계마다 팁을 추가해줘',
                    improvedResult: '⏰ 10분 완성! 직장인 김치볶음밥\n\n📋 재료 (1인분)\n• 밥 1공기 (차가운 밥이 더 좋아요)\n• 김치 100g (송송 썰기)\n• 식용유 1큰술\n• 간장 1작은술\n• 참기름 1작은술\n\n👨‍🍳 조리법\n1. 달군 팬에 식용유 두르기\n   💡 TIP: 센 불로 예열하면 볶음밥이 눌러붙지 않아요\n2. 썬 김치 볶기 (2분)\n   💡 TIP: 김치가 살짝 투명해질 때까지!\n3. 밥 넣고 볶은 뒤 참기름으로 마무리!\n\n🎉 든든한 한 끼 완성이에요!',
                    suggestions: ['타겟 명시 (혼자 사는 직장인)', '시간 제한 (10분)', '요리명 구체화 (김치볶음밥)', '배려 요청 (초보용 팁)'],
                    summaryFeedback: '요리 레시피는 대상을 누구로 하느냐에 따라 설명의 깊이가 달라집니다. "초보"를 위한 팁을 요청하자 훨씬 친절하고 구체적인 가이드가 생성되었습니다.'
                },
                {
                    id: 'c3',
                    topic: '어린이 교육 자료',
                    basicPrompt: '태양계 알려줘',
                    basicResult: '태양계에는 수성, 금성, 지구, 화성, 목성, 토성, 천왕성, 해왕성이 있습니다.',
                    improvedPrompt: '초등학교 3학년 학생들이 태양계를 쉽게 이해할 수 있는 학습 자료를 만들어줘. 각 행성의 특징을 이모지와 함께 간단하게 설명하고, 기억하기 쉬운 순서 암기법도 포함해줘',
                    improvedResult: '🌟 태양계 여행을 떠나볼까요?\n\n🌞 태양: 우리 태양계의 중심!\n🌍 지구: 우리가 사는 푸른 행성\n🪐 토성: 아름다운 고리가 있어요\n\n💡 암기 꿀팁!\n"수금지화목토천해" 앞글자만 따서 노래처럼 외워봐요!\n아이들 눈높이에 맞춘 행성별 이모지 설명이 포함되었습니다.',
                    suggestions: ['대상 연령 (초3)', '주제 명시 (태양계)', '형식 요청 (이모지 활용)', '추가 요소 (암기법)'],
                    summaryFeedback: '어린이 교육용 자료는 "눈높이"가 중요합니다. 대상 연령을 명시하고 이모지나 암기법 같은 구체적인 도구를 요구하면 AI는 훨씬 창의적인 교육자가 됩니다.'
                },
                {
                    id: 'c4',
                    topic: 'IT 기기 리뷰 블로그',
                    basicPrompt: '스마트폰 리뷰 써줘',
                    basicResult: '이번에 나온 스마트폰은 디자인이 예쁘고 속도가 빠릅니다. 추천합니다.',
                    improvedPrompt: '최신 아이폰15 프로의 1주일 사용 후기를 전문적인 테크 블로그 스타일로 써줘. 디자인, 카메라 성능, 배터리 지속시간이라는 3가지 소주제로 나누고, 실제 사용해본 사람만 알 수 있는 장점과 단점을 하나씩 포함해서 상세하게 작성해줘',
                    improvedResult: '📱 아이폰15 프로, 1주일간 써보니 어떨까? (실사용 리뷰)\n\n1. 티타늄의 가벼움, 디자인의 변화\n이번 모델의 핵심은 소재입니다. 1주일간 들어보니 확실히 손목의 피로도가 줄어든 것이 체감됩니다.\n\n2. 프로 레벨의 카메라 경험\n새로운 줌 렌즈는 놀랍지만, 야간 촬영 시 고스트 현상은 여전히 아쉬운 부분입니다.\n\n3. 배터리 성능과 발열\n헤비한 게임 실행 시 약간의 발열이 느껴지나, 일반적인 사용에서는 하루 종일 버티기에 충분했습니다.',
                    suggestions: ['제품명 명시 (아이폰15 프로)', '글의 구조 지정 (3가지 소주제)', '리뷰 스타일 (전문 테크 블로그)', '내용 조건 (장단점 포함)'],
                    summaryFeedback: '리뷰는 "진정성"과 "상세함"이 생명입니다. 소주제를 나누어 지정하고 장단점을 구체적으로 요구하면 AI는 단순 나열이 아닌 입체적인 분석글을 작성합니다.'
                }
            ];

            const currentC = challenges[currentChallenge];

            useEffect(() => {
                setChatHistory([{ role: 'ai', text: `안녕하세요! "${currentC.topic}" 작성을 도와드릴까요?` }]);
                setStepInChallenge(0);
            }, [currentChallenge]);

            const handleSendBasic = () => {
                setChatHistory(prev => [...prev, { role: 'user', text: currentC.basicPrompt }]);
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.basicResult + "\n\n(⚠️ 너무 단순한 결과가 나왔습니다. 프롬프트를 수정해볼까요?)" }]);
                    setStepInChallenge(1);
                }, 600);
            };

            const handleSendImproved = () => {
                setChatHistory(prev => [...prev, { role: 'user', text: currentC.improvedPrompt }]);
                setTimeout(() => {
                    setChatHistory(prev => [...prev, { role: 'ai', text: currentC.improvedResult }]);
                    setStepInChallenge(2);
                }, 800);
            };

            const handleNext = () => {
                if (currentChallenge < challenges.length - 1) {
                    setCurrentChallenge(currentChallenge + 1);
                } else {
                    markStageComplete('stage3');
                    goToStage(4);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">✏️</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-2">3단계: 프롬프트 수정하기</h2>
                        <p className="text-purple-600 font-bold italic">"아쉬운 결과를 직접 개선해보며 변화를 확인하세요!"</p>
                    </div>

                    <div className="grid md:grid-cols-3 gap-6 mb-8">
                        <div className="md:col-span-1 space-y-4">
                            <div className={`rounded-2xl p-5 border-2 transition-all ${stepInChallenge === 0 ? 'bg-blue-50 border-blue-300' : 'bg-gray-50 border-gray-200 opacity-60'}`}>
                                <h4 className="font-bold text-blue-800 mb-2">1. 기본 요청</h4>
                                <p className="text-gray-700 text-sm">먼저 기본 프롬프트를 보내 어떤 결과가 나오는지 확인해보세요.</p>
                            </div>
                            
                            <div className={`rounded-2xl p-5 border-2 transition-all ${stepInChallenge === 1 ? 'bg-green-50 border-green-300 scale-105' : 'bg-gray-50 border-gray-200 opacity-60'}`}>
                                <h4 className="font-bold text-green-800 mb-2">2. 개선 포인트 적용</h4>
                                <ul className="text-xs space-y-1 text-green-700">
                                    {currentC.suggestions.map((s, i) => <li key={i}>• {s}</li>)}
                                </ul>
                            </div>

                            {stepInChallenge === 2 && (
                                <div className="bg-amber-50 border-2 border-amber-200 rounded-2xl p-5 fade-in">
                                    <h4 className="font-bold text-amber-800 mb-1">✨ 결과 만족!</h4>
                                    <p className="text-xs text-amber-700">구체적인 지시가 훨씬 나은 결과를 만들었습니다.</p>
                                </div>
                            )}
                        </div>

                        <div className="md:col-span-2 chat-container p-6 flex flex-col h-[500px]">
                            <div className="flex-1 overflow-y-auto mb-4">
                                {chatHistory.map((chat, idx) => <ChatMessage key={idx} role={chat.role} text={chat.text} />)}
                            </div>
                            
                            <div className="space-y-2">
                                {stepInChallenge === 0 && (
                                    <button onClick={handleSendBasic} className="w-full bg-gray-600 text-white py-4 rounded-xl font-bold hover:bg-gray-700 transition-all shadow-md">
                                        💬 기본 프롬프트 전송하기
                                    </button>
                                )}
                                {stepInChallenge === 1 && (
                                    <button onClick={handleSendImproved} className="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg animate-pulse">
                                        🚀 개선된 프롬프트 전송하기
                                    </button>
                                )}
                                {stepInChallenge === 2 && (
                                    <button onClick={handleNext} className="w-full bg-purple-600 text-white py-4 rounded-xl font-bold hover:bg-purple-700 transition-all shadow-md">
                                        {currentChallenge < challenges.length - 1 ? '다음 챌린지 ➜' : '4단계로 이동 ➜'}
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>

                    {stepInChallenge === 2 && (
                        <div className="bg-blue-50 border-2 border-blue-200 rounded-2xl p-6 fade-in text-center">
                            <p className="text-gray-700 text-sm">
                                💡 <b>학습 포인트:</b> {currentC.summaryFeedback}
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        function Stage4({ goToStage, updateScore, markStageComplete }) {
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [earnedScore, setEarnedScore] = useState(0);

            const questions = [
                {
                    id: 'q1',
                    aiResult: '📊 2024년 1분기 온라인 매출 분석 보고서\n\n【핵심 지표】\n• 총 매출: 1억 2,300만원 (전년 대비 +23%)\n• 신규 고객: 1,247명 (전년 대비 +31%)\n• 재구매율: 42% (전년 대비 +5%p)\n• 평균 객단가: 98,600원 (전년 대비 +8%)\n\n【채널별 매출 비중】\n1. 자사몰: 45% (5,535만원)\n2. 네이버: 32% (3,936만원)\n3. 쿠팡: 23% (2,829만원)\n\n【인기 상품 TOP 3】\n1. 프리미엄 스킨케어 세트 (2,340만원)\n2. 비타민C 세럼 (1,890만원)\n3. 수분크림 (1,560만원)\n\n【개선 제안】\n• 재구매율이 높은 고객층 집중 공략\n• 쿠팡 채널 마케팅 강화 필요\n• 신제품 출시로 객단가 상승 유도',
                    question: '이 답변을 만든 프롬프트는?',
                    options: [
                        { id: 'a', text: '1분기 매출 데이터를 정리해서 보고서로 만들어줘. 전년 대비 증감률도 계산해줘', correct: false },
                        { id: 'b', text: '1분기 매출 데이터를 분석해서 보고서로 만들어줘. 전년 대비 증감률과 개선 제안도 포함해줘', correct: true }
                    ],
                    explanation: '실제 답변 맨 아래에 【개선 제안】섹션이 있어요. A는 데이터를 "정리"만 했지만, B는 "분석"하고 "개선 제안"까지 요청했기 때문에 더 유용한 보고서가 나왔습니다.',
                    points: 20
                },
                {
                    id: 'q2',
                    aiResult: '🔍 코드 리뷰 결과\n\n【긍정적인 부분】\n✅ 변수명이 직관적이고 읽기 쉽습니다\n✅ 함수가 작은 단위로 잘 분리되어 있습니다\n✅ 주석이 적절하게 작성되어 있습니다\n\n【개선이 필요한 부분】\n\n1️⃣ 에러 처리 부족\n```python\n# 현재\nresult = data / count\n\n# 개선\ntry:\n    result = data / count\nexcept ZeroDivisionError:\n    result = 0\n    logger.error("Division by zero")\n```\n\n2️⃣ 중복 코드\nget_user_name()과 get_admin_name() 함수가 거의 동일합니다.\n→ get_name(user_type) 하나로 통합하는 것을 권장합니다.\n\n3️⃣ 비효율적인 반복문\n```python\n# 현재\nfor item in items:\n    if item.status == "active":\n        process(item)\n\n# 개선\nactive_items = filter(lambda x: x.status == "active", items)\nfor item in active_items:\n    process(item)\n```\n\n【종합 평가】\n전체적으로 깔끔한 코드이나, 예외 처리와 성능 최적화가 필요합니다.\n추천 리팩토링 우선순위: 에러 처리 → 중복 제거 → 성능 개선',
                    question: '이 답변을 만든 프롬프트는?',
                    options: [
                        { id: 'a', text: 'Python 코드를 리뷰해줘. 좋은 점과 개선점을 나눠서 설명하고, 개선 부분은 Before/After 코드로 보여줘', correct: true },
                        { id: 'b', text: 'Python 코드를 전문적으로 리뷰해줘. 좋은 점, 개선점, 심각도 분석, 리팩토링 우선순위, 보안 취약점 검토, 성능 프로파일링, 테스트 커버리지 분석을 포함하고 각 항목마다 Before/After 코드와 성능 비교 수치를 제공해줘', correct: false }
                    ],
                    explanation: '실제 답변은 좋은 점, 개선점, Before/After 코드라는 "핵심 내용"만 간결하게 담고 있어요. A는 필요한 것만 요청해서 명확한 리뷰를 받았지만, B는 너무 많은 것을 요청해서 오히려 복잡해질 수 있어요.',
                    points: 20
                },
                {
                    id: 'q3',
                    aiResult: '🚀 "반려동물 AI 건강관리 앱" 투자 피칭\n\n【문제 정의】\n반려동물을 키우는 1,500만 가구 중 70%가 "우리 아이가 아픈지 모르겠다"고 응답했습니다. 동물병원 방문 시기를 놓쳐 치료비가 2배 이상 증가하는 사례가 빈번합니다.\n\n【솔루션】\n스마트폰으로 반려동물의 눈, 피부, 행동을 촬영하면 AI가 건강 상태를 실시간 분석하고, 이상 징후 발견 시 즉시 알림을 보냅니다.\n\n【핵심 기능】\n• AI 건강 스캔 (정확도 94%)\n• 증상별 대처법 가이드\n• 근처 동물병원 예약 연결\n• 건강 기록 자동 저장\n\n【시장 분석】\n• 국내 펫케어 시장: 6조원 (연 15% 성장)\n• 경쟁 앱 대비 차별점: AI 정확도 1위, 수의사 협업\n\n【수익 모델】\n1. 프리미엄 구독: 월 9,900원 (무제한 스캔)\n2. 병원 예약 수수료: 건당 3,000원\n3. 맞춤 영양제 판매: 평균 25% 수익률\n\n【목표】\n• 1년차: 사용자 10만명, 월 매출 5,000만원\n• 3년차: 사용자 100만명, 연 매출 100억원\n\n【투자 요청】\n시드 투자 5억원으로 서비스 정식 출시 및 마케팅\n예상 ROI: 3년 내 10배 이상',
                    question: '이 답변을 만든 프롬프트는?',
                    options: [
                        { id: 'a', text: '반려동물 AI 앱 투자 피칭 자료를 만들어줘. 문제, 솔루션, 시장 분석, 차별점을 포함해줘', correct: false },
                        { id: 'b', text: '반려동물 AI 앱 투자 피칭 자료를 만들어줘. 문제, 솔루션, 시장 분석과 함께 구체적인 수익 모델과 목표 수치를 포함해줘', correct: true }
                    ],
                    explanation: '실제 답변에는 【수익 모델】과 【목표】 섹션이 구체적 숫자와 함께 있어요. A는 추상적 내용만 요청했지만, B는 "구체적 수익 모델과 목표 수치"를 요청했기 때문에 투자자를 설득할 수 있는 자료가 나왔습니다.',
                    points: 20
                },
                {
                    id: 'q4',
                    aiResult: '✈️ [3박 4일 제주도 힐링 여행 계획]\n\n【1일차: 동쪽 해안 코스】\n• 오후 2시: 제주 공항 도착 및 렌터카 픽업\n• 오후 4시: 함덕 해수욕장 산책 (에메랄드빛 바다 감상)\n• 오후 6시: 흑돼지 구이 석식\n\n【2일차: 숲과 자연】\n• 오전 10시: 사려니숲길 걷기 (삼나무 힐링)\n• 오후 2시: 성산일출봉 조망 및 광치기 해변\n• 오후 5시: 빛의 벙커 전시 관람\n\n【추천 맛집 리스트】\n1. 〇〇식당 (갈치조림, 가성비 최고)\n2. △△카페 (바다뷰가 멋진 베이커리)\n\n【여행 팁】\n• 동쪽은 바람이 강하니 얇은 겉옷을 챙기세요.\n• 맛집은 미리 테이블링 앱으로 예약하는 것이 좋습니다.',
                    question: '이 답변을 만든 프롬프트는?',
                    options: [
                        { id: 'a', text: '제주도 여행 일정 짜줘', correct: false },
                        { id: 'b', text: '3박 4일 제주도 힐링 여행 일정을 짜줘. 일차별 주요 동선과 추천 맛집, 간단한 여행 팁도 포함해줘', correct: true }
                    ],
                    explanation: '답변에 기간(3박 4일), 컨셉(힐링), 구성(일차별 동선, 맛집, 팁)이 정확히 들어있습니다. B처럼 구체적인 구성 요소를 요청해야 정갈한 계획표를 얻을 수 있습니다.',
                    points: 20
                },
                {
                    id: 'q5',
                    aiResult: '✨ [신제품: 울트라 경량 텀블러 상세 페이지]\n\n【제품 헤드라인】\n"당신의 어깨가 가벼워지는 순간, 단 150g의 기적"\n\n【핵심 소구점 (USP)】\n1. 초경량 설계: 스마트폰보다 가벼운 150g으로 휴대성 극대화\n2. 강력 보온/보냉: 24시간 온도 유지 (이중 진공 구조)\n3. 친환경 소재: 환경 호르몬 걱정 없는 프리미엄 스테인리스\n\n【사용 타겟별 문구】\n• 직장인: "출퇴근길 가방 속, 무게감 없이 챙기세요."\n• 등산객: "정상에서 마시는 얼음물, 한 방울까지 시원하게."\n\n【구매 유도 (CTA)】\n지금 구매 시 전용 세척 솔 무료 증정! (한정 수량)',
                    question: '이 답변을 만든 프롬프트는?',
                    options: [
                        { id: 'a', text: '가벼운 텀블러 상세 페이지에 들어갈 내용을 써줘. 제품의 특징과 타겟별 문구, 구매 혜택을 포함해서 마케팅적으로 작성해줘', correct: true },
                        { id: 'b', text: '텀블러 홍보글 하나 써줘', correct: false }
                    ],
                    explanation: '답변을 보면 단순 홍보글이 아니라 상세 페이지 구조(헤드라인, USP, 타겟 문구, CTA)를 갖추고 있습니다. A처럼 마케팅적 구성 요소를 지정하면 훨씬 전문적인 문안이 생성됩니다.',
                    points: 20
                }
            ];

            const currentQ = questions[currentQuestion];

            const handleAnswer = (optionId) => {
                if (showFeedback) return;
                setSelectedAnswer(optionId);
                setShowFeedback(true);
                const option = currentQ.options.find(o => o.id === optionId);
                if (option.correct) {
                    updateScore(currentQ.points);
                    setEarnedScore(prev => prev + currentQ.points);
                }
            };

            const handleNext = () => {
                if (currentQuestion < questions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                    setSelectedAnswer(null);
                    setShowFeedback(false);
                } else {
                    markStageComplete('stage4');
                    goToStage(5);
                }
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-6xl mb-6 bounce">🎯</div>
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">4단계: 프롬프트 추론하기</h2>
                        <div className="mt-4 inline-block bg-purple-100 px-4 py-2 rounded-full font-bold text-purple-800">획득 점수: {earnedScore}점 / 100점</div>
                    </div>
                    <div className="bg-gray-50 border-2 border-gray-200 rounded-2xl p-6 mb-6">
                        <div className="flex items-center mb-4">
                            <span className="text-2xl mr-2">🤖</span>
                            <span className="font-bold text-gray-700">AI의 답변 결과:</span>
                        </div>
                        <div className="bg-white p-5 rounded-xl text-sm whitespace-pre-line border border-gray-200 leading-relaxed max-h-[300px] overflow-y-auto">
                            {currentQ.aiResult}
                        </div>
                    </div>
                    <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">{currentQ.question}</h3>
                    <div className="space-y-3">
                        {currentQ.options.map((option, idx) => (
                            <button key={option.id} onClick={() => handleAnswer(option.id)} disabled={showFeedback}
                                className={`w-full text-left p-5 rounded-xl border-2 transition-all ${
                                    showFeedback ? (option.correct ? 'bg-green-100 border-green-500' : (option.id === selectedAnswer ? 'bg-red-100 border-red-500' : 'bg-gray-50 border-gray-200'))
                                    : 'bg-white border-gray-300 hover:border-purple-400'
                                }`}>
                                <span className="font-bold mr-3">{idx + 1}.</span> {option.text}
                            </button>
                        ))}
                    </div>
                    {showFeedback && (
                        <div className={`mt-6 p-6 rounded-2xl border-2 border-dashed ${currentQ.options.find(o => o.id === selectedAnswer)?.correct ? 'bg-green-50 border-green-300' : 'bg-orange-50 border-orange-300'}`}>
                            <p className="font-bold mb-2">
                                {currentQ.options.find(o => o.id === selectedAnswer)?.correct ? '🎉 정답입니다!' : '💡 오답입니다.'}
                            </p>
                            <p className="text-gray-800 leading-relaxed">{currentQ.explanation}</p>
                            <button onClick={handleNext} className="w-full mt-4 bg-purple-600 text-white py-4 rounded-xl font-bold">다음 문제 ➜</button>
                        </div>
                    )}
                </div>
            );
        }

        function Stage5({ totalScore, setAllStagesCompleted }) {
            const certRef = useRef(null);
            const [checkedItems, setCheckedItems] = useState({});
            const keyLearnings = [
                { id: 'l1', title: '명확성 (Clarity)', desc: '프롬프트는 명확하고 구체적이어야 합니다.' },
                { id: 'l2', title: '구체성 (Specificity)', desc: '대상, 분량, 형식, 톤 등 구체적인 조건을 명시하면 더 맞춤화된 답변을 얻을 수 있습니다.' },
                { id: 'l3', title: '단계적 지시 (Step-by-step)', desc: '복잡한 작업은 단계별로 나누어 지시하면 AI가 더 체계적으로 응답합니다.' },
                { id: 'l4', title: '예시 제공 (Examples)', desc: '원하는 형식이나 스타일의 예시를 제공하면 AI가 더 정확하게 이해합니다.' },
                { id: 'l5', title: '반복적 개선 (Iteration)', desc: '첫 번째 결과가 만족스럽지 않다면 프롬프트를 수정해서 다시 시도하세요.' }
            ];

            const handleCheckItem = (id) => setCheckedItems(prev => ({ ...prev, [id]: !prev[id] }));
            const allChecked = Object.keys(checkedItems).length === keyLearnings.length && Object.values(checkedItems).every(v => v);

            useEffect(() => { if (allChecked) { setAllStagesCompleted(true); } }, [allChecked]);

            let level = '', emoji = '', rank = '', comment = '';
            if (totalScore >= 110) { level = '프롬프트 마스터'; emoji = '🏆'; rank = 'MASTER'; comment = '최고 수준!'; }
            else if (totalScore >= 80) { level = '프롬프트 전문가'; emoji = '🎓'; rank = 'EXPERT'; comment = '뛰어난 실력!'; }
            else { level = '프롬프트 학습자'; emoji = '🌱'; rank = 'BEGINNER'; comment = '좋은 출발!'; }

            const downloadCert = () => {
                html2canvas(certRef.current, { scale: 2, backgroundColor: '#ffffff' }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = '프롬프트챌린지_인증서.png';
                    link.href = canvas.toDataURL();
                    link.click();
                });
            };

            return (
                <div className="bg-white rounded-3xl shadow-2xl p-8 md:p-12 fade-in">
                    <div className="text-center mb-8">
                        <div className="text-7xl mb-6 bounce">🏆</div>
                        <h2 className="text-4xl font-bold text-gray-800 mb-6">챌린지 완료!</h2>
                    </div>
                    <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 border-2 border-purple-200 mb-6">
                        <h3 className="text-2xl font-bold text-purple-800 mb-4 text-center">📚 좋은 프롬프트의 5가지 조건</h3>
                        <div className="space-y-4">
                            {keyLearnings.map(item => (
                                <div key={item.id} onClick={() => handleCheckItem(item.id)} className={`bg-white rounded-xl p-5 flex items-start cursor-pointer border-2 transition-all ${checkedItems[item.id] ? 'border-green-300 bg-green-50' : 'border-gray-100 hover:border-purple-200'}`}>
                                    <div className={`w-6 h-6 rounded border-2 mr-4 flex items-center justify-center ${checkedItems[item.id] ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}>{checkedItems[item.id] && '✓'}</div>
                                    <div><h4 className="font-bold">{item.title}</h4><p className="text-sm text-gray-600">{item.desc}</p></div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div ref={certRef} className="bg-white rounded-3xl p-10 mb-8 border-4 border-double border-purple-300 text-center shadow-lg">
                        <div className="text-6xl mb-4">{emoji}</div>
                        <h3 className="text-3xl font-bold text-purple-800 mb-4">프롬프트 챌린지 인증서</h3>
                        <input type="text" placeholder="이름을 입력하세요" className="text-2xl font-bold text-center w-full border-b-2 border-yellow-400 mb-6 outline-none" />
                        <p className="text-gray-700 mb-8">위 사람은 프롬프트 엔지니어링 실습을 통해<br/>AI 활용 능력을 성공적으로 향상했음을 증명합니다.</p>
                        <div className="flex justify-center gap-4 mb-4">
                            <div className="bg-purple-100 px-6 py-4 rounded-2xl"><div className="text-xs text-purple-600">최종 점수</div><div className="text-3xl font-bold text-purple-800">{totalScore}점</div></div>
                            <div className="bg-yellow-100 px-6 py-4 rounded-2xl"><div className="text-xs text-yellow-600">레벨</div><div className="text-3xl font-bold text-yellow-800">{rank}</div></div>
                        </div>
                        <p className="text-gray-400 text-sm">{new Date().toLocaleDateString()}</p>
                    </div>
                    <button onClick={downloadCert} className="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white text-xl font-bold py-5 rounded-2xl shadow-xl hover:scale-[1.02] transition-all">📥 인증서 다운로드</button>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<PromptChallenge />);
    </script>
</body>
</html>